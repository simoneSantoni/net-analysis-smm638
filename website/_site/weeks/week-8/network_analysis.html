<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Fuller’s Beer Advocate Network Analysis – SMM638 - Network Analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-b25cb6ef9275ed217fc2e4ff85f8cf91.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-702d9172da3b3d749f5039613a8b0eaf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-b25cb6ef9275ed217fc2e4ff85f8cf91.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Fuller’s Beer Advocate Network Analysis</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../imgs/r-module-icon-light.svg" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../../imgs/r-module-icon-light.svg" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/simoneSantoni/net-analysis-smm638" title="Repository" class="quarto-navigation-tool px-1" aria-label="Repository"><i class="bi bi-github"></i></a>
    <a href="https://github.com/simoneSantoni/net-analysis-smm638/edit/master" title="Edit this page" class="quarto-navigation-tool px-1" aria-label="Edit this page"><i class="bi bi-pencil-square"></i></a>
    <a href="https://github.com/simoneSantoni/net-analysis-smm638/issues/new" title="Report an issue" class="quarto-navigation-tool px-1" aria-label="Report an issue"><i class="bi bi-bug"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Information</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course/schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course/support.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Support</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../course/team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Teaching team</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../project/midTermProject/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mid-term project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../project/finalCourseProject/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final course project</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Weekly materials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-1/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-2/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-3/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-4/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-5/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-6/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 6</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-7/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-8/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-9/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 9</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../weeks/week-10/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 10</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">All Slideshows</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Supplemental notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notes/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#analysis-pipeline" id="toc-analysis-pipeline" class="nav-link" data-scroll-target="#analysis-pipeline">Analysis Pipeline</a></li>
  <li><a href="#data-structure" id="toc-data-structure" class="nav-link" data-scroll-target="#data-structure">Data Structure</a></li>
  </ul></li>
  <li><a href="#loading-the-two-mode-network-data" id="toc-loading-the-two-mode-network-data" class="nav-link" data-scroll-target="#loading-the-two-mode-network-data">1. Loading the Two-Mode Network Data</a></li>
  <li><a href="#creating-a-networkx-bipartite-graph" id="toc-creating-a-networkx-bipartite-graph" class="nav-link" data-scroll-target="#creating-a-networkx-bipartite-graph">2. Creating a NetworkX Bipartite Graph</a></li>
  <li><a href="#projecting-onto-users-one-mode-network" id="toc-projecting-onto-users-one-mode-network" class="nav-link" data-scroll-target="#projecting-onto-users-one-mode-network">3. Projecting onto Users (One-Mode Network)</a></li>
  <li><a href="#network-visualization" id="toc-network-visualization" class="nav-link" data-scroll-target="#network-visualization">4. Network Visualization</a></li>
  <li><a href="#community-detection-algorithms" id="toc-community-detection-algorithms" class="nav-link" data-scroll-target="#community-detection-algorithms">5. Community Detection Algorithms</a>
  <ul class="collapse">
  <li><a href="#louvain-algorithm" id="toc-louvain-algorithm" class="nav-link" data-scroll-target="#louvain-algorithm">5.1 Louvain Algorithm</a></li>
  <li><a href="#label-propagation" id="toc-label-propagation" class="nav-link" data-scroll-target="#label-propagation">5.2 Label Propagation</a></li>
  <li><a href="#greedy-modularity-optimization" id="toc-greedy-modularity-optimization" class="nav-link" data-scroll-target="#greedy-modularity-optimization">5.3 Greedy Modularity Optimization</a></li>
  <li><a href="#algorithm-comparison" id="toc-algorithm-comparison" class="nav-link" data-scroll-target="#algorithm-comparison">5.4 Algorithm Comparison</a></li>
  </ul></li>
  <li><a href="#results-summary" id="toc-results-summary" class="nav-link" data-scroll-target="#results-summary">6. Results Summary</a></li>
  <li><a href="#writing-the-projected-network-to-file" id="toc-writing-the-projected-network-to-file" class="nav-link" data-scroll-target="#writing-the-projected-network-to-file">7. Writing the Projected Network to File</a></li>
  <li><a href="#reading-the-network-back" id="toc-reading-the-network-back" class="nav-link" data-scroll-target="#reading-the-network-back">8. Reading the Network Back</a></li>
  <li><a href="#graph-tool-network-instantiation" id="toc-graph-tool-network-instantiation" class="nav-link" data-scroll-target="#graph-tool-network-instantiation">9. Graph-Tool Network Instantiation</a></li>
  <li><a href="#stochastic-weighted-block-model" id="toc-stochastic-weighted-block-model" class="nav-link" data-scroll-target="#stochastic-weighted-block-model">10. Stochastic Weighted Block Model</a></li>
  <li><a href="#visualizing-the-hierarchical-block-model" id="toc-visualizing-the-hierarchical-block-model" class="nav-link" data-scroll-target="#visualizing-the-hierarchical-block-model">11. Visualizing the Hierarchical Block Model</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Fuller’s Beer Advocate Network Analysis</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Week 8 - Network Analytics</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This notebook analyzes the BeerAdvocate forum participation data accompanying the Fuller’s teaching case. We examine how beer enthusiasts allocate their attention across different beer styles, revealing community structure through network analysis.</p>
<section id="analysis-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="analysis-pipeline">Analysis Pipeline</h3>
<p>The analysis proceeds through five main stages:</p>
<ol type="1">
<li><strong>Data Loading &amp; Network Construction</strong>: Load user-style participation data and build a two-mode (bipartite) network</li>
<li><strong>Network Projection</strong>: Transform the bipartite network into a one-mode user similarity network</li>
<li><strong>Structural Analysis</strong>: Compute network statistics and assess small-world properties</li>
<li><strong>Community Detection</strong>: Apply modularity-based algorithms (Louvain, Label Propagation, Greedy)</li>
<li><strong>Stochastic Block Modeling</strong>: Fit a hierarchical weighted SBM using graph-tool for probabilistic community inference</li>
</ol>
</section>
<section id="data-structure" class="level3">
<h3 class="anchored" data-anchor-id="data-structure">Data Structure</h3>
<p>The data represents a <strong>two-mode (bipartite) network</strong> where:</p>
<ul>
<li><strong>Users</strong> (1,000 nodes) participate in forum discussions</li>
<li><strong>Beer Styles</strong> (20 nodes) represent categories of discussion</li>
<li><strong>Edges</strong> connect users to the styles they discuss, weighted by post count</li>
</ul>
<p>When projected onto users, this network reveals attention-based communities—groups of enthusiasts who engage with similar styles. The projection creates an edge between two users whenever they share interest in at least one beer style, with edge weights reflecting the strength of shared attention.</p>
<div id="setup" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> networkx.algorithms <span class="im">import</span> bipartite</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NetworkX version:"</span>, nx.__version__)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>NetworkX version: 3.5</code></pre>
</div>
</div>
</section>
</section>
<section id="loading-the-two-mode-network-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-two-mode-network-data">1. Loading the Two-Mode Network Data</h2>
<p>We load three CSV files:</p>
<ul>
<li><code>beer_styles.csv</code>: Reference table of 20 beer styles</li>
<li><code>ba_users.csv</code>: User node attributes</li>
<li><code>ba_edges.csv</code>: User-to-style participation edges</li>
</ul>
<div id="load-data" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load beer styles reference</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>styles_df <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/beer_styles.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Beer Styles:"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(styles_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Beer Styles:
style_id        style_name  community  popularity
     S01    English Bitter          1        0.70
     S02               ESB          1        0.60
     S03  English Pale Ale          1        0.50
     S04              Mild          1        0.30
     S05      American IPA          2        0.90
     S06        Double IPA          2        0.80
     S07 American Pale Ale          2        0.75
     S08       Session IPA          2        0.50
     S09    Belgian Tripel          3        0.60
     S10    Belgian Dubbel          3        0.55
     S11            Saison          3        0.65
     S12           Witbier          3        0.50
     S13    Imperial Stout          4        0.70
     S14            Porter          4        0.60
     S15     Oatmeal Stout          4        0.50
     S16     Baltic Porter          4        0.40
     S17    German Pilsner          5        0.65
     S18     Czech Pilsner          5        0.55
     S19            Helles          5        0.45
     S20       Schwarzbier          5        0.35</code></pre>
</div>
</div>
<div id="load-users" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load user data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>users_df <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/ba_users.csv'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Users: </span><span class="sc">{</span><span class="bu">len</span>(users_df)<span class="sc">}</span><span class="ss"> records"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">User attributes:"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(users_df.head(<span class="dv">10</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Primary community distribution:"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(users_df[<span class="st">'primary_community'</span>].value_counts().sort_index())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Users: 1000 records

User attributes:
  user_id  primary_community  is_bridge  n_styles  days_active  total_posts
0   U0001                  2      False         4           91            8
1   U0002                  1      False         6          365           92
2   U0003                  1      False         3          103            7
3   U0004                  2      False         4          236           17
4   U0005                  3      False         2          252           38
5   U0006                  2      False         2          357            5
6   U0007                  3      False         3          450           21
7   U0008                  1      False         3           42           90
8   U0009                  2      False         4          318           10
9   U0010                  5      False         2         1053           56

Primary community distribution:
primary_community
1    155
2    331
3    220
4    188
5    106
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="load-edges" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load edges (user -&gt; style participation)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>edges_df <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/ba_edges.csv'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Edges: </span><span class="sc">{</span><span class="bu">len</span>(edges_df)<span class="sc">}</span><span class="ss"> user-style connections"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Edge sample:"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edges_df.head(<span class="dv">10</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Post count statistics:"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edges_df[<span class="st">'post_count'</span>].describe())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Edges: 3613 user-style connections

Edge sample:
  user_id        beer_style  post_count
0   U0001        Double IPA           3
1   U0001           Witbier           3
2   U0001       Session IPA           1
3   U0001    Imperial Stout           1
4   U0002              Mild          12
5   U0002    English Bitter           1
6   U0002       Session IPA          54
7   U0002  English Pale Ale          11
8   U0002               ESB           5
9   U0002    German Pilsner           9

Post count statistics:
count    3613.000000
mean       12.459452
std        18.198178
min         1.000000
25%         2.000000
50%         5.000000
75%        15.000000
max       181.000000
Name: post_count, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="creating-a-networkx-bipartite-graph" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-networkx-bipartite-graph">2. Creating a NetworkX Bipartite Graph</h2>
<p>We construct the two-mode network using NetworkX, with users and beer styles as the two node sets.</p>
<div id="create-bipartite" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty bipartite graph</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> nx.Graph()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add user nodes (bipartite=0)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>user_ids <span class="op">=</span> users_df[<span class="st">'user_id'</span>].tolist()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> users_df.iterrows():</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    B.add_node(row[<span class="st">'user_id'</span>],</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>               bipartite<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>               node_type<span class="op">=</span><span class="st">'user'</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>               primary_community<span class="op">=</span>row[<span class="st">'primary_community'</span>],</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>               is_bridge<span class="op">=</span>row[<span class="st">'is_bridge'</span>],</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>               days_active<span class="op">=</span>row[<span class="st">'days_active'</span>],</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>               total_posts<span class="op">=</span>row[<span class="st">'total_posts'</span>])</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add style nodes (bipartite=1)</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> styles_df.iterrows():</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    B.add_node(row[<span class="st">'style_name'</span>],</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>               bipartite<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>               node_type<span class="op">=</span><span class="st">'style'</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>               community<span class="op">=</span>row[<span class="st">'community'</span>],</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>               popularity<span class="op">=</span>row[<span class="st">'popularity'</span>])</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add weighted edges</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> edges_df.iterrows():</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    B.add_edge(row[<span class="st">'user_id'</span>], row[<span class="st">'beer_style'</span>], weight<span class="op">=</span>row[<span class="st">'post_count'</span>])</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify bipartite structure</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>user_nodes <span class="op">=</span> {n <span class="cf">for</span> n, d <span class="kw">in</span> B.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">'bipartite'</span>] <span class="op">==</span> <span class="dv">0</span>}</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>style_nodes <span class="op">=</span> {n <span class="cf">for</span> n, d <span class="kw">in</span> B.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">'bipartite'</span>] <span class="op">==</span> <span class="dv">1</span>}</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Bipartite Network Created"</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  User nodes: </span><span class="sc">{</span><span class="bu">len</span>(user_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Style nodes: </span><span class="sc">{</span><span class="bu">len</span>(style_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total edges: </span><span class="sc">{</span>B<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Is bipartite: </span><span class="sc">{</span>bipartite<span class="sc">.</span>is_bipartite(B)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bipartite Network Created
  User nodes: 1000
  Style nodes: 20
  Total edges: 3613
  Is bipartite: True</code></pre>
</div>
</div>
<div id="bipartite-stats" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic bipartite network statistics</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bipartite Network Statistics:"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Network density: </span><span class="sc">{</span>nx<span class="sc">.</span>density(B)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Average degree (users): </span><span class="sc">{</span>np<span class="sc">.</span>mean([B.degree(n) <span class="cf">for</span> n <span class="kw">in</span> user_nodes])<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Average degree (styles): </span><span class="sc">{</span>np<span class="sc">.</span>mean([B.degree(n) <span class="cf">for</span> n <span class="kw">in</span> style_nodes])<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Degree distribution for styles</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>style_degrees <span class="op">=</span> [(n, B.degree(n)) <span class="cf">for</span> n <span class="kw">in</span> style_nodes]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>style_degrees.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Style engagement (degree):"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> style, degree <span class="kw">in</span> style_degrees[:<span class="dv">10</span>]:</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>style<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>degree<span class="sc">}</span><span class="ss"> users"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Bipartite Network Statistics:
  Network density: 0.0070
  Average degree (users): 3.61
  Average degree (styles): 180.65

Style engagement (degree):
  American IPA: 286 users
  Double IPA: 280 users
  American Pale Ale: 273 users
  Session IPA: 233 users
  Saison: 200 users
  Imperial Stout: 200 users
  ESB: 195 users
  English Bitter: 194 users
  Belgian Dubbel: 187 users
  Witbier: 185 users</code></pre>
</div>
</div>
</section>
<section id="projecting-onto-users-one-mode-network" class="level2">
<h2 class="anchored" data-anchor-id="projecting-onto-users-one-mode-network">3. Projecting onto Users (One-Mode Network)</h2>
<p>We project the bipartite network onto the user node set. In the projected network, two users are connected if they both participate in discussions about at least one common beer style. Edge weights reflect the strength of shared interests.</p>
<div id="project-users" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Project bipartite network onto users</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using weighted projection where weight = sum of shared style participations</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>G_users <span class="op">=</span> bipartite.weighted_projected_graph(B, user_nodes)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"User Projection (One-Mode Network)"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Density: </span><span class="sc">{</span>nx<span class="sc">.</span>density(G_users)<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>User Projection (One-Mode Network)
  Nodes: 1000
  Edges: 242861
  Density: 0.4862</code></pre>
</div>
</div>
<div id="projection-stats" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze projected network</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Projected Network Statistics:"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Connectivity</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> nx.is_connected(G_users):</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Connected: Yes"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Diameter: </span><span class="sc">{</span>nx<span class="sc">.</span>diameter(G_users)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Average shortest path: </span><span class="sc">{</span>nx<span class="sc">.</span>average_shortest_path_length(G_users)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    largest_cc <span class="op">=</span> <span class="bu">max</span>(nx.connected_components(G_users), key<span class="op">=</span><span class="bu">len</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Connected: No"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of components: </span><span class="sc">{</span>nx<span class="sc">.</span>number_connected_components(G_users)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Largest component: </span><span class="sc">{</span><span class="bu">len</span>(largest_cc)<span class="sc">}</span><span class="ss"> nodes"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>avg_clustering <span class="op">=</span> nx.average_clustering(G_users)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Average clustering coefficient: </span><span class="sc">{</span>avg_clustering<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Transitivity (global clustering)</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>transitivity <span class="op">=</span> nx.transitivity(G_users)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Transitivity (global clustering): </span><span class="sc">{</span>transitivity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Degree statistics</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>degrees <span class="op">=</span> [d <span class="cf">for</span> n, d <span class="kw">in</span> G_users.degree()]</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Degree statistics:"</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Min: </span><span class="sc">{</span><span class="bu">min</span>(degrees)<span class="sc">}</span><span class="ss">, Max: </span><span class="sc">{</span><span class="bu">max</span>(degrees)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>np<span class="sc">.</span>mean(degrees)<span class="sc">:.2f}</span><span class="ss">, Std: </span><span class="sc">{</span>np<span class="sc">.</span>std(degrees)<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Projected Network Statistics:
  Connected: Yes
  Diameter: 2
  Average shortest path: 1.514
  Average clustering coefficient: 0.6934
  Transitivity (global clustering): 0.6575

Degree statistics:
  Min: 160, Max: 889
  Mean: 485.72, Std: 141.60</code></pre>
</div>
</div>
<div id="small-world-check" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Small-world analysis</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Small-World Analysis:"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> G_users.number_of_nodes()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> G_users.number_of_edges()</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> m <span class="op">/</span> (n <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>))  <span class="co"># Edge probability</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to random graph expectations</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>expected_clustering_random <span class="op">=</span> p</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>expected_path_random <span class="op">=</span> np.log(n) <span class="op">/</span> np.log(n <span class="op">*</span> p) <span class="cf">if</span> n <span class="op">*</span> p <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Actual clustering: </span><span class="sc">{</span>avg_clustering<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Expected (random): </span><span class="sc">{</span>expected_clustering_random<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Clustering ratio: </span><span class="sc">{</span>avg_clustering <span class="op">/</span> expected_clustering_random<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> nx.is_connected(G_users):</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    actual_path <span class="op">=</span> nx.average_shortest_path_length(G_users)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Actual avg path length: </span><span class="sc">{</span>actual_path<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Expected (random): </span><span class="sc">{</span>expected_path_random<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Small-world coefficient (sigma)</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> (avg_clustering <span class="op">/</span> expected_clustering_random) <span class="op">/</span> (actual_path <span class="op">/</span> expected_path_random)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Small-world coefficient (σ): </span><span class="sc">{</span>sigma<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  (σ &gt; 1 indicates small-world structure)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Small-World Analysis:
  Actual clustering: 0.6934
  Expected (random): 0.4862
  Clustering ratio: 1.43x

  Actual avg path length: 1.514
  Expected (random): 1.117

  Small-world coefficient (σ): 1.05
  (σ &gt; 1 indicates small-world structure)</code></pre>
</div>
</div>
</section>
<section id="network-visualization" class="level2">
<h2 class="anchored" data-anchor-id="network-visualization">4. Network Visualization</h2>
<p>We visualize the projected user network, coloring nodes by their primary community affiliation.</p>
<div id="viz-prep" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare node colors based on primary community</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>community_colors <span class="op">=</span> {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="st">'#E41A1C'</span>,  <span class="co"># Red - Traditional British</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="st">'#377EB8'</span>,  <span class="co"># Blue - American Craft</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="st">'#4DAF4A'</span>,  <span class="co"># Green - Belgian</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="st">'#984EA3'</span>,  <span class="co"># Purple - Dark/Roasted</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="st">'#FF7F00'</span>,  <span class="co"># Orange - Lager</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>node_colors <span class="op">=</span> []</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> G_users.nodes():</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    comm <span class="op">=</span> users_df[users_df[<span class="st">'user_id'</span>] <span class="op">==</span> node][<span class="st">'primary_community'</span>].values[<span class="dv">0</span>]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    node_colors.append(community_colors[comm])</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify bridge users for highlighting</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>bridge_users <span class="op">=</span> <span class="bu">set</span>(users_df[users_df[<span class="st">'is_bridge'</span>] <span class="op">==</span> <span class="va">True</span>][<span class="st">'user_id'</span>])</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>node_sizes <span class="op">=</span> [<span class="dv">50</span> <span class="cf">if</span> n <span class="kw">in</span> bridge_users <span class="cf">else</span> <span class="dv">20</span> <span class="cf">for</span> n <span class="kw">in</span> G_users.nodes()]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-viz-spring" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spring layout visualization (sample for readability)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For large networks, we sample nodes</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="op">=</span> <span class="bu">min</span>(<span class="dv">300</span>, G_users.number_of_nodes())</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>sample_nodes <span class="op">=</span> <span class="bu">list</span>(G_users.nodes())[:sample_size]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>G_sample <span class="op">=</span> G_users.subgraph(sample_nodes)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get colors for sample</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>sample_colors <span class="op">=</span> [node_colors[<span class="bu">list</span>(G_users.nodes()).index(n)] <span class="cf">for</span> n <span class="kw">in</span> G_sample.nodes()]</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>sample_sizes <span class="op">=</span> [node_sizes[<span class="bu">list</span>(G_users.nodes()).index(n)] <span class="cf">for</span> n <span class="kw">in</span> G_sample.nodes()]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute layout</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> nx.spring_layout(G_sample, k<span class="op">=</span><span class="fl">0.3</span>, iterations<span class="op">=</span><span class="dv">50</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw edges with low alpha</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_edges(G_sample, pos, alpha<span class="op">=</span><span class="fl">0.05</span>, edge_color<span class="op">=</span><span class="st">'gray'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw nodes</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_nodes(G_sample, pos, node_color<span class="op">=</span>sample_colors,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                       node_size<span class="op">=</span>sample_sizes, alpha<span class="op">=</span><span class="fl">0.7</span>, ax<span class="op">=</span>ax)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>legend_patches <span class="op">=</span> [</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">1</span>], label<span class="op">=</span><span class="st">'Traditional British'</span>),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">2</span>], label<span class="op">=</span><span class="st">'American Craft'</span>),</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">3</span>], label<span class="op">=</span><span class="st">'Belgian'</span>),</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">4</span>], label<span class="op">=</span><span class="st">'Dark/Roasted'</span>),</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">5</span>], label<span class="op">=</span><span class="st">'Lager'</span>),</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>legend_patches, loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Beer Enthusiast Network (sample of </span><span class="sc">{</span>sample_size<span class="sc">}</span><span class="ss"> users)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="viz-spring" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="network_analysis_files/figure-html/viz-spring-output-1.png" width="1142" height="949" class="figure-img"></p>
<figcaption>User network with spring layout (colored by primary community)</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-viz-degree-dist" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Degree histogram</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>degrees <span class="op">=</span> [d <span class="cf">for</span> n, d <span class="kw">in</span> G_users.degree()]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(degrees, bins<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Degree'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Degree Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(np.mean(degrees), color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'Mean: </span><span class="sc">{</span>np<span class="sc">.</span>mean(degrees)<span class="sc">:.0f}</span><span class="ss">'</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-log degree distribution</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>degree_counts <span class="op">=</span> Counter(degrees)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">list</span>(degree_counts.keys())</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="bu">list</span>(degree_counts.values())</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(x, y, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xscale(<span class="st">'log'</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_yscale(<span class="st">'log'</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Degree (log)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency (log)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Degree Distribution (Log-Log)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="viz-degree-dist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="network_analysis_files/figure-html/viz-degree-dist-output-1.png" width="1335" height="468" class="figure-img"></p>
<figcaption>Degree distribution of the projected user network</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="community-detection-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="community-detection-algorithms">5. Community Detection Algorithms</h2>
<p>We apply several community detection algorithms to the projected network and compare their results.</p>
<section id="louvain-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="louvain-algorithm">5.1 Louvain Algorithm</h3>
<div id="louvain" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Louvain community detection</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>louvain_communities <span class="op">=</span> nx.community.louvain_communities(G_users, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Louvain Community Detection"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of communities: </span><span class="sc">{</span><span class="bu">len</span>(louvain_communities)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Community sizes:"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">sorted</span>(louvain_communities, key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)):</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Community </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(comm)<span class="sc">}</span><span class="ss"> users"</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate modularity</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>louvain_modularity <span class="op">=</span> nx.community.modularity(G_users, louvain_communities)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Modularity: </span><span class="sc">{</span>louvain_modularity<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Louvain Community Detection
  Number of communities: 5

  Community sizes:
    Community 1: 306 users
    Community 2: 243 users
    Community 3: 200 users
    Community 4: 184 users
    Community 5: 67 users

  Modularity: 0.2742</code></pre>
</div>
</div>
<div id="louvain-analysis" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze community composition</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Louvain Community Composition (by original community):"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">sorted</span>(louvain_communities, key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">5</span>]):</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    comm_users <span class="op">=</span> users_df[users_df[<span class="st">'user_id'</span>].isin(comm)]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    primary_dist <span class="op">=</span> comm_users[<span class="st">'primary_community'</span>].value_counts()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    dominant <span class="op">=</span> primary_dist.idxmax()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    dominant_pct <span class="op">=</span> primary_dist.<span class="bu">max</span>() <span class="op">/</span> <span class="bu">len</span>(comm) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Detected Community </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(comm)<span class="sc">}</span><span class="ss"> users):"</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Dominant original community: </span><span class="sc">{</span>dominant<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>dominant_pct<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Distribution: </span><span class="sc">{</span><span class="bu">dict</span>(primary_dist.sort_index())<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Louvain Community Composition (by original community):

  Detected Community 1 (306 users):
    Dominant original community: 2 (88.9%)
    Distribution: {1: np.int64(3), 2: np.int64(272), 3: np.int64(6), 4: np.int64(15), 5: np.int64(10)}

  Detected Community 2 (243 users):
    Dominant original community: 3 (81.9%)
    Distribution: {1: np.int64(7), 2: np.int64(16), 3: np.int64(199), 4: np.int64(8), 5: np.int64(13)}

  Detected Community 3 (200 users):
    Dominant original community: 1 (70.0%)
    Distribution: {1: np.int64(140), 2: np.int64(25), 3: np.int64(7), 4: np.int64(7), 5: np.int64(21)}

  Detected Community 4 (184 users):
    Dominant original community: 4 (84.8%)
    Distribution: {1: np.int64(5), 2: np.int64(16), 3: np.int64(6), 4: np.int64(156), 5: np.int64(1)}

  Detected Community 5 (67 users):
    Dominant original community: 5 (91.0%)
    Distribution: {2: np.int64(2), 3: np.int64(2), 4: np.int64(2), 5: np.int64(61)}</code></pre>
</div>
</div>
</section>
<section id="label-propagation" class="level3">
<h3 class="anchored" data-anchor-id="label-propagation">5.2 Label Propagation</h3>
<div id="label-prop" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Label propagation</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>label_prop_communities <span class="op">=</span> <span class="bu">list</span>(nx.community.label_propagation_communities(G_users))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Label Propagation Community Detection"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of communities: </span><span class="sc">{</span><span class="bu">len</span>(label_prop_communities)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Community sizes (top 10):"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">sorted</span>(label_prop_communities, key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">10</span>]):</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Community </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(comm)<span class="sc">}</span><span class="ss"> users"</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate modularity</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>label_prop_modularity <span class="op">=</span> nx.community.modularity(G_users, label_prop_communities)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Modularity: </span><span class="sc">{</span>label_prop_modularity<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Label Propagation Community Detection
  Number of communities: 1

  Community sizes (top 10):
    Community 1: 1000 users

  Modularity: 0.0000</code></pre>
</div>
</div>
</section>
<section id="greedy-modularity-optimization" class="level3">
<h3 class="anchored" data-anchor-id="greedy-modularity-optimization">5.3 Greedy Modularity Optimization</h3>
<div id="greedy-modularity" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Greedy modularity optimization</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>greedy_communities <span class="op">=</span> <span class="bu">list</span>(nx.community.greedy_modularity_communities(G_users))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Greedy Modularity Optimization"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of communities: </span><span class="sc">{</span><span class="bu">len</span>(greedy_communities)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Community sizes:"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">sorted</span>(greedy_communities, key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)):</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Community </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(comm)<span class="sc">}</span><span class="ss"> users"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate modularity</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>greedy_modularity <span class="op">=</span> nx.community.modularity(G_users, greedy_communities)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Modularity: </span><span class="sc">{</span>greedy_modularity<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Greedy Modularity Optimization
  Number of communities: 4

  Community sizes:
    Community 1: 351 users
    Community 2: 312 users
    Community 3: 275 users
    Community 4: 62 users

  Modularity: 0.1387</code></pre>
</div>
</div>
</section>
<section id="algorithm-comparison" class="level3">
<h3 class="anchored" data-anchor-id="algorithm-comparison">5.4 Algorithm Comparison</h3>
<div id="cell-compare-algorithms" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary comparison</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Algorithm'</span>: [<span class="st">'Louvain'</span>, <span class="st">'Label Propagation'</span>, <span class="st">'Greedy Modularity'</span>],</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Communities'</span>: [<span class="bu">len</span>(louvain_communities), <span class="bu">len</span>(label_prop_communities), <span class="bu">len</span>(greedy_communities)],</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Modularity'</span>: [louvain_modularity, label_prop_modularity, greedy_modularity],</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Largest Community'</span>: [</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="bu">len</span>(c) <span class="cf">for</span> c <span class="kw">in</span> louvain_communities),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="bu">len</span>(c) <span class="cf">for</span> c <span class="kw">in</span> label_prop_communities),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="bu">len</span>(c) <span class="cf">for</span> c <span class="kw">in</span> greedy_communities)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Algorithm Comparison:"</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Modularity comparison</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#2ecc71'</span>, <span class="st">'#3498db'</span>, <span class="st">'#e74c3c'</span>]</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].bar(results[<span class="st">'Algorithm'</span>], results[<span class="st">'Modularity'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Modularity'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Modularity by Algorithm'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>, <span class="bu">max</span>(results[<span class="st">'Modularity'</span>]) <span class="op">*</span> <span class="fl">1.2</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, v <span class="kw">in</span> <span class="bu">enumerate</span>(results[<span class="st">'Modularity'</span>]):</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].text(i, v <span class="op">+</span> <span class="fl">0.01</span>, <span class="ss">f'</span><span class="sc">{</span>v<span class="sc">:.3f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Community count comparison</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].bar(results[<span class="st">'Algorithm'</span>], results[<span class="st">'Communities'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Number of Communities'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Communities Detected'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, v <span class="kw">in</span> <span class="bu">enumerate</span>(results[<span class="st">'Communities'</span>]):</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>].text(i, v <span class="op">+</span> <span class="fl">0.5</span>, <span class="bu">str</span>(v), ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Algorithm Comparison:
        Algorithm  Communities  Modularity  Largest Community
          Louvain            5    0.274228                306
Label Propagation            1    0.000000               1000
Greedy Modularity            4    0.138717                351</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="compare-algorithms" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="network_analysis_files/figure-html/compare-algorithms-output-2.png" width="1143" height="471" class="figure-img"></p>
<figcaption>Comparison of community detection algorithms</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="results-summary" class="level2">
<h2 class="anchored" data-anchor-id="results-summary">6. Results Summary</h2>
<div id="summary" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NETWORK ANALYSIS SUMMARY"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">1. BIPARTITE NETWORK"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Users: </span><span class="sc">{</span><span class="bu">len</span>(user_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Beer Styles: </span><span class="sc">{</span><span class="bu">len</span>(style_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Edges: </span><span class="sc">{</span>B<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. PROJECTED USER NETWORK"</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Nodes: </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Edges: </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Density: </span><span class="sc">{</span>nx<span class="sc">.</span>density(G_users)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Avg Clustering: </span><span class="sc">{</span>avg_clustering<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> nx.is_connected(G_users):</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Avg Path Length: </span><span class="sc">{</span>nx<span class="sc">.</span>average_shortest_path_length(G_users)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Diameter: </span><span class="sc">{</span>nx<span class="sc">.</span>diameter(G_users)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. SMALL-WORLD PROPERTIES"</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Clustering ratio (vs random): </span><span class="sc">{</span>avg_clustering <span class="op">/</span> expected_clustering_random<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Network exhibits small-world structure: </span><span class="sc">{</span><span class="st">'Yes'</span> <span class="cf">if</span> avg_clustering <span class="op">/</span> expected_clustering_random <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">'No'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">4. COMMUNITY DETECTION"</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Best algorithm (by modularity): </span><span class="sc">{</span>comparison_df<span class="sc">.</span>loc[comparison_df[<span class="st">'Modularity'</span>].idxmax(), <span class="st">'Algorithm'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Best modularity score: </span><span class="sc">{</span>comparison_df[<span class="st">'Modularity'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Consensus community count: ~</span><span class="sc">{</span><span class="bu">int</span>(np.median(results[<span class="st">'Communities'</span>]))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">5. KEY INSIGHTS"</span>)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - The network shows clear community structure aligned with beer style families"</span>)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - High clustering indicates users form cohesive interest groups"</span>)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Short path lengths suggest bridging connections across communities"</span>)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Community detection recovers the underlying style-based segmentation"</span>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
NETWORK ANALYSIS SUMMARY
======================================================================

1. BIPARTITE NETWORK
   - Users: 1000
   - Beer Styles: 20
   - Edges: 3613

2. PROJECTED USER NETWORK
   - Nodes: 1000
   - Edges: 242861
   - Density: 0.4862
   - Avg Clustering: 0.6934
   - Avg Path Length: 1.514
   - Diameter: 2

3. SMALL-WORLD PROPERTIES
   - Clustering ratio (vs random): 1.43x
   - Network exhibits small-world structure: Yes

4. COMMUNITY DETECTION
   - Best algorithm (by modularity): Louvain
   - Best modularity score: 0.2742
   - Consensus community count: ~4

5. KEY INSIGHTS
   - The network shows clear community structure aligned with beer style families
   - High clustering indicates users form cohesive interest groups
   - Short path lengths suggest bridging connections across communities
   - Community detection recovers the underlying style-based segmentation
======================================================================</code></pre>
</div>
</div>
</section>
<section id="writing-the-projected-network-to-file" class="level2">
<h2 class="anchored" data-anchor-id="writing-the-projected-network-to-file">7. Writing the Projected Network to File</h2>
<p>We save the projected user network in multiple formats for further analysis.</p>
<div id="write-network" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create node attributes dataframe for the projected network</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>node_attrs <span class="op">=</span> []</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> G_users.nodes():</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    user_data <span class="op">=</span> users_df[users_df[<span class="st">'user_id'</span>] <span class="op">==</span> node].iloc[<span class="dv">0</span>]</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find Louvain community assignment</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    louvain_comm <span class="op">=</span> <span class="va">None</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(louvain_communities):</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node <span class="kw">in</span> comm:</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>            louvain_comm <span class="op">=</span> i</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    node_attrs.append({</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'id'</span>: node,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'primary_community'</span>: user_data[<span class="st">'primary_community'</span>],</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'is_bridge'</span>: user_data[<span class="st">'is_bridge'</span>],</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'days_active'</span>: user_data[<span class="st">'days_active'</span>],</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_posts'</span>: user_data[<span class="st">'total_posts'</span>],</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'degree'</span>: G_users.degree(node),</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'louvain_community'</span>: louvain_comm</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>nodes_export_df <span class="op">=</span> pd.DataFrame(node_attrs)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>nodes_export_df.to_csv(<span class="st">'../../../data/beerAdvocate/projected_nodes.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Saved: projected_nodes.csv"</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nodes_export_df.head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Saved: projected_nodes.csv
      id  primary_community  is_bridge  days_active  total_posts  degree  \
0  U0363                  2      False         2077           28     624   
1  U0113                  2       True          101            5     385   
2  U0184                  2      False          154           10     369   
3  U0590                  2       True          349            7     341   
4  U0269                  2      False           44            8     615   

   louvain_community  
0                  0  
1                  2  
2                  4  
3                  2  
4                  0  </code></pre>
</div>
</div>
<div id="write-edges" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export edges with weights</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>edges_export <span class="op">=</span> []</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> u, v, d <span class="kw">in</span> G_users.edges(data<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    edges_export.append({</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'source'</span>: u,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'target'</span>: v,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'weight'</span>: d.get(<span class="st">'weight'</span>, <span class="dv">1</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>edges_export_df <span class="op">=</span> pd.DataFrame(edges_export)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>edges_export_df.to_csv(<span class="st">'../../../data/beerAdvocate/projected_edges.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Saved: projected_edges.csv (</span><span class="sc">{</span><span class="bu">len</span>(edges_export_df)<span class="sc">}</span><span class="ss"> edges)"</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edges_export_df.head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Saved: projected_edges.csv (242861 edges)
  source target  weight
0  U0363  U0269       4
1  U0363  U0206       4
2  U0363  U0335       3
3  U0363  U0195       1
4  U0363  U0151       3</code></pre>
</div>
</div>
<div id="write-graphml" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as GraphML for compatibility with other tools</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>nx.write_graphml(G_users, <span class="st">'../../../data/beerAdvocate/user_network.graphml'</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Saved: user_network.graphml"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Also save edge list format</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>nx.write_edgelist(G_users, <span class="st">'../../../data/beerAdvocate/user_network.edgelist'</span>, data<span class="op">=</span>[<span class="st">'weight'</span>])</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Saved: user_network.edgelist"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Saved: user_network.graphml
Saved: user_network.edgelist</code></pre>
</div>
</div>
</section>
<section id="reading-the-network-back" class="level2">
<h2 class="anchored" data-anchor-id="reading-the-network-back">8. Reading the Network Back</h2>
<p>We verify the saved files by reading them back and reconstructing the network.</p>
<div id="read-network" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read from CSV files</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>nodes_read <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/projected_nodes.csv'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>edges_read <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/projected_edges.csv'</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Reading network from CSV files..."</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span><span class="bu">len</span>(nodes_read)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span><span class="bu">len</span>(edges_read)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reconstruct NetworkX graph</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>G_reconstructed <span class="op">=</span> nx.Graph()</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nodes with attributes</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> nodes_read.iterrows():</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    G_reconstructed.add_node(row[<span class="st">'id'</span>],</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>                             primary_community<span class="op">=</span>row[<span class="st">'primary_community'</span>],</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>                             is_bridge<span class="op">=</span>row[<span class="st">'is_bridge'</span>],</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>                             degree<span class="op">=</span>row[<span class="st">'degree'</span>],</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>                             louvain_community<span class="op">=</span>row[<span class="st">'louvain_community'</span>])</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add edges with weights</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> edges_read.iterrows():</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    G_reconstructed.add_edge(row[<span class="st">'source'</span>], row[<span class="st">'target'</span>], weight<span class="op">=</span>row[<span class="st">'weight'</span>])</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Reconstructed graph:"</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span>G_reconstructed<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>G_reconstructed<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Matches original: </span><span class="sc">{</span>G_reconstructed<span class="sc">.</span>number_of_nodes() <span class="op">==</span> G_users<span class="sc">.</span>number_of_nodes() <span class="kw">and</span> G_reconstructed<span class="sc">.</span>number_of_edges() <span class="op">==</span> G_users<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading network from CSV files...
  Nodes: 1000
  Edges: 242861

Reconstructed graph:
  Nodes: 1000
  Edges: 242861
  Matches original: True</code></pre>
</div>
</div>
<div id="read-graphml" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read from GraphML</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>G_from_graphml <span class="op">=</span> nx.read_graphml(<span class="st">'../../../data/beerAdvocate/user_network.graphml'</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Read from GraphML:"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span>G_from_graphml<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>G_from_graphml<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Read from GraphML:
  Nodes: 1000
  Edges: 242861</code></pre>
</div>
</div>
</section>
<section id="graph-tool-network-instantiation" class="level2">
<h2 class="anchored" data-anchor-id="graph-tool-network-instantiation">9. Graph-Tool Network Instantiation</h2>
<p>We now convert the network to graph-tool format for advanced analysis. Graph-tool is a highly efficient Python library for network analysis that provides sophisticated algorithms including stochastic block models.</p>
<div id="graphtool-setup" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import graph-tool</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> graph_tool.<span class="bu">all</span> <span class="im">as</span> gt</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    GRAPH_TOOL_AVAILABLE <span class="op">=</span> <span class="va">True</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"graph-tool version: </span><span class="sc">{</span>gt<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    GRAPH_TOOL_AVAILABLE <span class="op">=</span> <span class="va">False</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"graph-tool is not installed."</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"To install: conda install -c conda-forge graph-tool"</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Or see: https://graph-tool.skewed.de/"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>graph-tool version: 2.98 (commit 9c32966d, )</code></pre>
</div>
</div>
<div id="graphtool-convert" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create graph-tool graph</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> gt.Graph(directed<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create vertex property map for node IDs</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    v_id <span class="op">=</span> g.new_vertex_property(<span class="st">"string"</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    v_primary_comm <span class="op">=</span> g.new_vertex_property(<span class="st">"int"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    v_is_bridge <span class="op">=</span> g.new_vertex_property(<span class="st">"bool"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    v_louvain <span class="op">=</span> g.new_vertex_property(<span class="st">"int"</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create edge property map for weights</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    e_weight <span class="op">=</span> g.new_edge_property(<span class="st">"double"</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map from node ID to vertex</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    node_to_vertex <span class="op">=</span> {}</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add vertices</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> nodes_read.iterrows():</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> g.add_vertex()</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>        node_to_vertex[row[<span class="st">'id'</span>]] <span class="op">=</span> v</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>        v_id[v] <span class="op">=</span> row[<span class="st">'id'</span>]</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>        v_primary_comm[v] <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">'primary_community'</span>])</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>        v_is_bridge[v] <span class="op">=</span> <span class="bu">bool</span>(row[<span class="st">'is_bridge'</span>])</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>        v_louvain[v] <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">'louvain_community'</span>])</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add edges</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> edges_read.iterrows():</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>        e <span class="op">=</span> g.add_edge(node_to_vertex[row[<span class="st">'source'</span>]],</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>                       node_to_vertex[row[<span class="st">'target'</span>]])</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>        e_weight[e] <span class="op">=</span> row[<span class="st">'weight'</span>]</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set as internal properties</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>    g.vertex_properties[<span class="st">"id"</span>] <span class="op">=</span> v_id</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>    g.vertex_properties[<span class="st">"primary_community"</span>] <span class="op">=</span> v_primary_comm</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>    g.vertex_properties[<span class="st">"is_bridge"</span>] <span class="op">=</span> v_is_bridge</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>    g.vertex_properties[<span class="st">"louvain_community"</span>] <span class="op">=</span> v_louvain</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>    g.edge_properties[<span class="st">"weight"</span>] <span class="op">=</span> e_weight</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Graph-tool network created:"</span>)</span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Vertices: </span><span class="sc">{</span>g<span class="sc">.</span>num_vertices()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>g<span class="sc">.</span>num_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Skipping graph-tool conversion (not installed)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Graph-tool network created:
  Vertices: 1000
  Edges: 242861</code></pre>
</div>
</div>
</section>
<section id="stochastic-weighted-block-model" class="level2">
<h2 class="anchored" data-anchor-id="stochastic-weighted-block-model">10. Stochastic Weighted Block Model</h2>
<p>The Stochastic Block Model (SBM) is a generative model for networks that assumes nodes belong to groups (blocks), and the probability of an edge between two nodes depends only on their group memberships.</p>
<p>Graph-tool provides a <strong>hierarchical nested SBM</strong> implementation that:</p>
<ul>
<li>Discovers multi-level community structure automatically</li>
<li>Handles edge weights natively</li>
<li>Uses Bayesian inference to avoid overfitting</li>
<li>Provides statistically principled model selection</li>
</ul>
<p>The weighted SBM approach follows <a href="https://doi.org/10.1103/PhysRevE.97.012306">Peixoto (2018)</a>, which extends the nonparametric SBM framework to incorporate edge weights through microcanonical distributions (here, <code>real-exponential</code> for continuous positive weights).</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Reference
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Peixoto, T. P. (2018). Nonparametric weighted stochastic block models. <em>Physical Review E</em>, 97(1), 012306. <a href="https://doi.org/10.1103/PhysRevE.97.012306">doi:10.1103/PhysRevE.97.012306</a> | <a href="https://arxiv.org/abs/1708.01432">arXiv:1708.01432</a></p>
</div>
</div>
</div>
<div id="sbm-fit" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Fitting Hierarchical Nested Stochastic Block Model..."</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"(This may take a few minutes for large networks)</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit weighted hierarchical nested SBM using minimize_nested_blockmodel_dl</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This finds optimal hierarchical partition by minimizing description length</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The nested model automatically discovers multiple levels of community structure</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    nested_state <span class="op">=</span> gt.minimize_nested_blockmodel_dl(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        g,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        state_args<span class="op">=</span><span class="bu">dict</span>(recs<span class="op">=</span>[e_weight], rec_types<span class="op">=</span>[<span class="st">"real-exponential"</span>])</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Initial description length: </span><span class="sc">{</span>nested_state<span class="sc">.</span>entropy()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Improve solution with merge-split MCMC sweeps</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Refining solution with merge-split MCMC..."</span>)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>        ret <span class="op">=</span> nested_state.multiflip_mcmc_sweep(niter<span class="op">=</span><span class="dv">10</span>, beta<span class="op">=</span>np.inf)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Refined description length: </span><span class="sc">{</span>nested_state<span class="sc">.</span>entropy()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the hierarchy of block states</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    levels <span class="op">=</span> nested_state.get_levels()</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Hierarchical SBM Results:"</span>)</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of hierarchy levels: </span><span class="sc">{</span><span class="bu">len</span>(levels)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Hierarchy structure:"</span>)</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, level_state <span class="kw">in</span> <span class="bu">enumerate</span>(levels):</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>        level_blocks <span class="op">=</span> level_state.get_blocks()</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>        level_block_counts <span class="op">=</span> Counter(level_blocks[v] <span class="cf">for</span> v <span class="kw">in</span> level_state.g.vertices())</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>        n_level_blocks <span class="op">=</span> <span class="bu">len</span>(level_block_counts)</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Level </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>level_state<span class="sc">.</span>g<span class="sc">.</span>num_vertices()<span class="sc">}</span><span class="ss"> nodes → </span><span class="sc">{</span>n_level_blocks<span class="sc">}</span><span class="ss"> blocks"</span>)</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get bottom-level (finest) block assignments for nodes</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>    bottom_state <span class="op">=</span> levels[<span class="dv">0</span>]</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>    blocks <span class="op">=</span> bottom_state.get_blocks()</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count blocks at bottom level</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>    block_counts <span class="op">=</span> Counter(blocks[v] <span class="cf">for</span> v <span class="kw">in</span> g.vertices())</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>    n_blocks <span class="op">=</span> <span class="bu">len</span>(block_counts)</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Bottom-level block sizes:"</span>)</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> block_id, count <span class="kw">in</span> <span class="bu">sorted</span>(block_counts.items(), key<span class="op">=</span><span class="kw">lambda</span> x: <span class="op">-</span>x[<span class="dv">1</span>])[:<span class="dv">10</span>]:</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Block </span><span class="sc">{</span>block_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> nodes"</span>)</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_blocks <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    ... and </span><span class="sc">{</span>n_blocks <span class="op">-</span> <span class="dv">10</span><span class="sc">}</span><span class="ss"> more blocks"</span>)</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Skipping SBM (graph-tool not installed)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting Hierarchical Nested Stochastic Block Model...
(This may take a few minutes for large networks)

Initial description length: 656073.00

Refining solution with merge-split MCMC...
Refined description length: 653166.22

Hierarchical SBM Results:
  Number of hierarchy levels: 11

  Hierarchy structure:
    Level 0: 1000 nodes → 45 blocks
    Level 1: 1000 nodes → 25 blocks
    Level 2: 49 nodes → 11 blocks
    Level 3: 13 nodes → 5 blocks
    Level 4: 7 nodes → 1 blocks
    Level 5: 6 nodes → 1 blocks
    Level 6: 1 nodes → 1 blocks
    Level 7: 1 nodes → 1 blocks
    Level 8: 1 nodes → 1 blocks
    Level 9: 1 nodes → 1 blocks
    Level 10: 1 nodes → 1 blocks

  Bottom-level block sizes:
    Block 512: 61 nodes
    Block 483: 52 nodes
    Block 896: 47 nodes
    Block 921: 46 nodes
    Block 554: 39 nodes
    Block 160: 37 nodes
    Block 886: 37 nodes
    Block 38: 31 nodes
    Block 205: 28 nodes
    Block 371: 27 nodes
    ... and 35 more blocks</code></pre>
</div>
</div>
<div id="sbm-analysis" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analyze correspondence between SBM blocks and original communities</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">SBM Block Composition (by original community):"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create mapping</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    sbm_assignments <span class="op">=</span> {}</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> g.vertices():</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>        node_id <span class="op">=</span> v_id[v]</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>        block <span class="op">=</span> blocks[v]</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>        orig_comm <span class="op">=</span> v_primary_comm[v]</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> block <span class="kw">not</span> <span class="kw">in</span> sbm_assignments:</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>            sbm_assignments[block] <span class="op">=</span> []</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        sbm_assignments[block].append(orig_comm)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print composition</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> block_id <span class="kw">in</span> <span class="bu">sorted</span>(sbm_assignments.keys()):</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>        members <span class="op">=</span> sbm_assignments[block_id]</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>        comm_dist <span class="op">=</span> Counter(members)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        dominant <span class="op">=</span> comm_dist.most_common(<span class="dv">1</span>)[<span class="dv">0</span>]</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Block </span><span class="sc">{</span>block_id<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(members)<span class="sc">}</span><span class="ss"> nodes):"</span>)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Dominant community: </span><span class="sc">{</span>dominant[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>dominant[<span class="dv">1</span>]<span class="op">/</span><span class="bu">len</span>(members)<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Distribution: </span><span class="sc">{</span><span class="bu">dict</span>(<span class="bu">sorted</span>(comm_dist.items()))<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SBM Block Composition (by original community):

  Block 9 (26 nodes):
    Dominant community: 2 (53.8%)
    Distribution: {2: 14, 3: 3, 4: 8, 5: 1}

  Block 11 (12 nodes):
    Dominant community: 5 (33.3%)
    Distribution: {1: 1, 3: 3, 4: 4, 5: 4}

  Block 22 (12 nodes):
    Dominant community: 5 (50.0%)
    Distribution: {2: 5, 3: 1, 5: 6}

  Block 38 (31 nodes):
    Dominant community: 4 (74.2%)
    Distribution: {2: 4, 3: 4, 4: 23}

  Block 83 (22 nodes):
    Dominant community: 2 (77.3%)
    Distribution: {2: 17, 3: 5}

  Block 122 (18 nodes):
    Dominant community: 1 (94.4%)
    Distribution: {1: 17, 5: 1}

  Block 149 (16 nodes):
    Dominant community: 2 (37.5%)
    Distribution: {1: 2, 2: 6, 3: 3, 4: 5}

  Block 160 (37 nodes):
    Dominant community: 2 (48.6%)
    Distribution: {1: 7, 2: 18, 3: 2, 4: 10}

  Block 188 (16 nodes):
    Dominant community: 5 (43.8%)
    Distribution: {1: 3, 3: 6, 5: 7}

  Block 205 (28 nodes):
    Dominant community: 5 (100.0%)
    Distribution: {5: 28}

  Block 242 (19 nodes):
    Dominant community: 3 (78.9%)
    Distribution: {1: 1, 2: 3, 3: 15}

  Block 255 (26 nodes):
    Dominant community: 3 (92.3%)
    Distribution: {2: 2, 3: 24}

  Block 267 (16 nodes):
    Dominant community: 2 (43.8%)
    Distribution: {1: 5, 2: 7, 5: 4}

  Block 290 (14 nodes):
    Dominant community: 2 (50.0%)
    Distribution: {2: 7, 4: 6, 5: 1}

  Block 324 (16 nodes):
    Dominant community: 4 (87.5%)
    Distribution: {3: 1, 4: 14, 5: 1}

  Block 362 (12 nodes):
    Dominant community: 2 (91.7%)
    Distribution: {2: 11, 3: 1}

  Block 371 (27 nodes):
    Dominant community: 2 (55.6%)
    Distribution: {1: 8, 2: 15, 3: 1, 4: 1, 5: 2}

  Block 438 (16 nodes):
    Dominant community: 3 (93.8%)
    Distribution: {2: 1, 3: 15}

  Block 447 (15 nodes):
    Dominant community: 3 (93.3%)
    Distribution: {3: 14, 5: 1}

  Block 474 (21 nodes):
    Dominant community: 2 (95.2%)
    Distribution: {2: 20, 5: 1}

  Block 483 (52 nodes):
    Dominant community: 4 (98.1%)
    Distribution: {3: 1, 4: 51}

  Block 493 (25 nodes):
    Dominant community: 5 (64.0%)
    Distribution: {1: 9, 5: 16}

  Block 512 (61 nodes):
    Dominant community: 3 (95.1%)
    Distribution: {2: 2, 3: 58, 5: 1}

  Block 517 (20 nodes):
    Dominant community: 3 (50.0%)
    Distribution: {2: 5, 3: 10, 5: 5}

  Block 525 (14 nodes):
    Dominant community: 3 (64.3%)
    Distribution: {2: 4, 3: 9, 5: 1}

  Block 535 (14 nodes):
    Dominant community: 5 (42.9%)
    Distribution: {1: 3, 4: 5, 5: 6}

  Block 540 (19 nodes):
    Dominant community: 2 (100.0%)
    Distribution: {2: 19}

  Block 542 (3 nodes):
    Dominant community: 4 (100.0%)
    Distribution: {4: 3}

  Block 554 (39 nodes):
    Dominant community: 2 (100.0%)
    Distribution: {2: 39}

  Block 565 (23 nodes):
    Dominant community: 3 (56.5%)
    Distribution: {3: 13, 4: 1, 5: 9}

  Block 567 (22 nodes):
    Dominant community: 4 (50.0%)
    Distribution: {1: 4, 2: 5, 4: 11, 5: 2}

  Block 610 (11 nodes):
    Dominant community: 1 (100.0%)
    Distribution: {1: 11}

  Block 624 (23 nodes):
    Dominant community: 3 (69.6%)
    Distribution: {1: 6, 2: 1, 3: 16}

  Block 649 (25 nodes):
    Dominant community: 3 (36.0%)
    Distribution: {1: 9, 2: 4, 3: 9, 5: 3}

  Block 665 (10 nodes):
    Dominant community: 2 (100.0%)
    Distribution: {2: 10}

  Block 673 (11 nodes):
    Dominant community: 1 (81.8%)
    Distribution: {1: 9, 2: 2}

  Block 855 (10 nodes):
    Dominant community: 4 (80.0%)
    Distribution: {2: 2, 4: 8}

  Block 859 (10 nodes):
    Dominant community: 1 (100.0%)
    Distribution: {1: 10}

  Block 886 (37 nodes):
    Dominant community: 2 (100.0%)
    Distribution: {2: 37}

  Block 896 (47 nodes):
    Dominant community: 1 (95.7%)
    Distribution: {1: 45, 5: 2}

  Block 921 (46 nodes):
    Dominant community: 4 (56.5%)
    Distribution: {2: 19, 3: 1, 4: 26}

  Block 942 (10 nodes):
    Dominant community: 2 (70.0%)
    Distribution: {2: 7, 4: 1, 5: 2}

  Block 950 (23 nodes):
    Dominant community: 2 (100.0%)
    Distribution: {2: 23}

  Block 965 (22 nodes):
    Dominant community: 4 (45.5%)
    Distribution: {1: 5, 3: 5, 4: 10, 5: 2}

  Block 995 (23 nodes):
    Dominant community: 2 (95.7%)
    Distribution: {2: 22, 4: 1}</code></pre>
</div>
</div>
</section>
<section id="visualizing-the-hierarchical-block-model" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-the-hierarchical-block-model">11. Visualizing the Hierarchical Block Model</h2>
<p>The nested SBM can be visualized in multiple ways: 1. <strong>Hierarchical tree</strong>: Shows the nested community structure 2. <strong>Network with block colors</strong>: Traditional network layout colored by blocks 3. <strong>Block matrix</strong>: Edge density between blocks</p>
<div id="sbm-viz-hierarchy" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> matplotlib.cm</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Drawing hierarchical block model structure..."</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Draw the nested block model hierarchy with edge weights</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Edge color and width are mapped to weight using log scale</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    nested_state.draw(</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        edge_color<span class="op">=</span>gt.prop_to_size(e_weight, power<span class="op">=</span><span class="dv">1</span>, log<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        ecmap<span class="op">=</span>(matplotlib.cm.inferno, <span class="fl">0.6</span>),</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        eorder<span class="op">=</span>e_weight,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        edge_pen_width<span class="op">=</span>gt.prop_to_size(e_weight, <span class="dv">1</span>, <span class="dv">4</span>, power<span class="op">=</span><span class="dv">1</span>, log<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        edge_gradient<span class="op">=</span>[],</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>        vertex_size<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        output_size<span class="op">=</span>(<span class="dv">1200</span>, <span class="dv">1000</span>),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        output<span class="op">=</span><span class="st">"../../../data/beerAdvocate/sbm_hierarchy.png"</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Saved hierarchical visualization to: sbm_hierarchy.png"</span>)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display in notebook</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> IPython.display <span class="im">import</span> Image</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    Image(filename<span class="op">=</span><span class="st">'../../../data/beerAdvocate/sbm_hierarchy.png'</span>)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Skipping SBM visualization (graph-tool not installed)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Drawing hierarchical block model structure...
Saved hierarchical visualization to: sbm_hierarchy.png</code></pre>
</div>
</div>
<div id="cell-sbm-matrix" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize the block model structure at bottom level</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get unique block IDs that actually exist</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    unique_blocks <span class="op">=</span> <span class="bu">sorted</span>(block_counts.keys())</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    block_to_idx <span class="op">=</span> {b: i <span class="cf">for</span> i, b <span class="kw">in</span> <span class="bu">enumerate</span>(unique_blocks)}</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    n_blocks_viz <span class="op">=</span> <span class="bu">len</span>(unique_blocks)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create block matrix (edge counts between blocks)</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    block_matrix <span class="op">=</span> np.zeros((n_blocks_viz, n_blocks_viz))</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> e <span class="kw">in</span> g.edges():</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>        b1, b2 <span class="op">=</span> blocks[e.source()], blocks[e.target()]</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> b1 <span class="kw">in</span> block_to_idx <span class="kw">and</span> b2 <span class="kw">in</span> block_to_idx:</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>            i1, i2 <span class="op">=</span> block_to_idx[b1], block_to_idx[b2]</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>            block_matrix[i1, i2] <span class="op">+=</span> e_weight[e]</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i1 <span class="op">!=</span> i2:</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>                block_matrix[i2, i1] <span class="op">+=</span> e_weight[e]</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize by block sizes for probability</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    block_sizes <span class="op">=</span> np.array([block_counts[b] <span class="cf">for</span> b <span class="kw">in</span> unique_blocks])</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>    block_probs <span class="op">=</span> block_matrix <span class="op">/</span> np.outer(block_sizes, block_sizes)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> ax.imshow(block_probs, cmap<span class="op">=</span><span class="st">'YlOrRd'</span>)</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Block'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Block'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Hierarchical SBM: Edge Density Between Bottom-Level Blocks'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only show tick labels if not too many blocks</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_blocks_viz <span class="op">&lt;=</span> <span class="dv">20</span>:</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>        ax.set_xticks(<span class="bu">range</span>(n_blocks_viz))</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>        ax.set_yticks(<span class="bu">range</span>(n_blocks_viz))</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>        ax.set_xticklabels(unique_blocks)</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>        ax.set_yticklabels(unique_blocks)</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(im, ax<span class="op">=</span>ax, label<span class="op">=</span><span class="st">'Edge Density'</span>)</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">'../../../data/beerAdvocate/block_matrix.png'</span>, dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Saved: block_matrix.png"</span>)</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Skipping block matrix visualization (graph-tool not installed)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="sbm-matrix" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="network_analysis_files/figure-html/sbm-matrix-output-1.png" width="866" height="757" class="figure-img"></p>
<figcaption>Block model edge probability matrix</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Saved: block_matrix.png</code></pre>
</div>
</div>
<div id="final-comparison" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"COMMUNITY DETECTION COMPARISON"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate SBM modularity for comparison using bottom-level blocks</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use actual block IDs from block_counts (they may not be contiguous)</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    sbm_communities <span class="op">=</span> []</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> block_id <span class="kw">in</span> block_counts.keys():</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>        comm <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> v <span class="kw">in</span> g.vertices():</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> blocks[v] <span class="op">==</span> block_id:</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>                comm.add(v_id[v])</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> comm:</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>            sbm_communities.append(comm)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verify we have a valid partition before calculating modularity</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    all_sbm_nodes <span class="op">=</span> <span class="bu">set</span>().union(<span class="op">*</span>sbm_communities) <span class="cf">if</span> sbm_communities <span class="cf">else</span> <span class="bu">set</span>()</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(all_sbm_nodes) <span class="op">==</span> G_users.number_of_nodes():</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>        sbm_modularity <span class="op">=</span> nx.community.modularity(G_users, sbm_communities)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Warning: SBM partition covers </span><span class="sc">{</span><span class="bu">len</span>(all_sbm_nodes)<span class="sc">}</span><span class="ss"> of </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss"> nodes"</span>)</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>        sbm_modularity <span class="op">=</span> <span class="bu">float</span>(<span class="st">'nan'</span>)</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'Algorithm'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Communities'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Modularity'</span><span class="sc">:&gt;12}</span><span class="ss">"</span>)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">55</span>)</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Louvain'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(louvain_communities)<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>louvain_modularity<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Label Propagation'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(label_prop_communities)<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>label_prop_modularity<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Greedy Modularity'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(greedy_communities)<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>greedy_modularity<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    sbm_mod_str <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>sbm_modularity<span class="sc">:&gt;12.4f}</span><span class="ss">"</span> <span class="cf">if</span> <span class="kw">not</span> np.isnan(sbm_modularity) <span class="cf">else</span> <span class="st">"         N/A"</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Nested SBM (bottom level)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>n_blocks<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>sbm_mod_str<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">55</span>)</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">True communities (from data): 5"</span>)</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">The hierarchical nested SBM provides:"</span>)</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span><span class="bu">len</span>(levels)<span class="sc">}</span><span class="ss"> levels of hierarchy"</span>)</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Bayesian model selection (no need to specify # of communities)"</span>)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Description length: </span><span class="sc">{</span>nested_state<span class="sc">.</span>entropy()<span class="sc">:.2f}</span><span class="ss"> (lower = better fit)"</span>)</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Multi-scale community structure discovery"</span>)</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
COMMUNITY DETECTION COMPARISON
======================================================================

Algorithm                       Communities   Modularity
-------------------------------------------------------
Louvain                                   5       0.2742
Label Propagation                         1       0.0000
Greedy Modularity                         4       0.1387
Nested SBM (bottom level)                45       0.0436
-------------------------------------------------------

True communities (from data): 5

The hierarchical nested SBM provides:
  - 11 levels of hierarchy
  - Bayesian model selection (no need to specify # of communities)
  - Description length: 653166.22 (lower = better fit)
  - Multi-scale community structure discovery
======================================================================</code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This analysis demonstrates the workflow for:</p>
<ol type="1">
<li><strong>Loading and constructing</strong> a two-mode (bipartite) network from forum participation data</li>
<li><strong>Projecting</strong> the network onto users to reveal attention-based similarity</li>
<li><strong>Analyzing</strong> network properties including small-world characteristics</li>
<li><strong>Detecting communities</strong> using multiple algorithms (Louvain, Label Propagation, Greedy Modularity)</li>
<li><strong>Applying hierarchical nested stochastic block models</strong> for multi-scale probabilistic community detection</li>
<li><strong>Visualizing</strong> the network structure, community assignments, and hierarchical block model</li>
</ol>
<p>The <strong>hierarchical nested SBM</strong> offers several advantages over flat community detection:</p>
<ul>
<li><strong>Multi-scale discovery</strong>: Reveals community structure at multiple resolutions simultaneously</li>
<li><strong>Bayesian model selection</strong>: Automatically determines the optimal number of communities without user specification</li>
<li><strong>Edge weight support</strong>: Natively incorporates connection strengths into the inference</li>
<li><strong>Hierarchical interpretation</strong>: Shows how fine-grained communities nest within larger groupings</li>
</ul>
<p>The results show that beer enthusiasts form distinct communities based on their attention patterns—engaging primarily with styles from their preferred family (British, American Craft, Belgian, Dark, or Lager) while some “bridge” users connect across communities. The hierarchical structure may reveal sub-communities within these major groupings.</p>
<p>For Fuller’s market research, these attention-based segments offer insights that traditional preference surveys cannot capture: they reveal not what consumers claim to like, but where they actually direct their engagement and curiosity.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/simonesantoni\.github\.io\/net-analysis-smm638");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Fuller's Beer Advocate Network Analysis"</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Week 8 - Network Analytics"</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: auto</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>This notebook analyzes the BeerAdvocate forum participation data accompanying the Fuller's teaching case. We examine how beer enthusiasts allocate their attention across different beer styles, revealing community structure through network analysis.</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analysis Pipeline</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>The analysis proceeds through five main stages:</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Data Loading &amp; Network Construction**: Load user-style participation data and build a two-mode (bipartite) network</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Network Projection**: Transform the bipartite network into a one-mode user similarity network</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Structural Analysis**: Compute network statistics and assess small-world properties</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Community Detection**: Apply modularity-based algorithms (Louvain, Label Propagation, Greedy)</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Stochastic Block Modeling**: Fit a hierarchical weighted SBM using graph-tool for probabilistic community inference</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Structure</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>The data represents a **two-mode (bipartite) network** where:</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Users** (1,000 nodes) participate in forum discussions</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Beer Styles** (20 nodes) represent categories of discussion</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Edges** connect users to the styles they discuss, weighted by post count</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>When projected onto users, this network reveals attention-based communities—groups of enthusiasts who engage with similar styles. The projection creates an edge between two users whenever they share interest in at least one beer style, with edge weights reflecting the strength of shared attention.</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Import libraries"</span></span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> networkx.algorithms <span class="im">import</span> bipartite</span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Set random seed for reproducibility</span></span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NetworkX version:"</span>, nx.__version__)</span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Loading the Two-Mode Network Data</span></span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a>We load three CSV files:</span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`beer_styles.csv`</span>: Reference table of 20 beer styles</span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ba_users.csv`</span>: User node attributes</span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ba_edges.csv`</span>: User-to-style participation edges</span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-72"><a href="#cb58-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-data</span></span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Load beer styles reference</span></span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a>styles_df <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/beer_styles.csv'</span>)</span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Beer Styles:"</span>)</span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(styles_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-82"><a href="#cb58-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-83"><a href="#cb58-83" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-users</span></span>
<span id="cb58-84"><a href="#cb58-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-85"><a href="#cb58-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Load user data</span></span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a>users_df <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/ba_users.csv'</span>)</span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Users: </span><span class="sc">{</span><span class="bu">len</span>(users_df)<span class="sc">}</span><span class="ss"> records"</span>)</span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">User attributes:"</span>)</span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(users_df.head(<span class="dv">10</span>))</span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Primary community distribution:"</span>)</span>
<span id="cb58-91"><a href="#cb58-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(users_df[<span class="st">'primary_community'</span>].value_counts().sort_index())</span>
<span id="cb58-92"><a href="#cb58-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-93"><a href="#cb58-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-96"><a href="#cb58-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-97"><a href="#cb58-97" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-edges</span></span>
<span id="cb58-98"><a href="#cb58-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-99"><a href="#cb58-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Load edges (user -&gt; style participation)</span></span>
<span id="cb58-100"><a href="#cb58-100" aria-hidden="true" tabindex="-1"></a>edges_df <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/ba_edges.csv'</span>)</span>
<span id="cb58-101"><a href="#cb58-101" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Edges: </span><span class="sc">{</span><span class="bu">len</span>(edges_df)<span class="sc">}</span><span class="ss"> user-style connections"</span>)</span>
<span id="cb58-102"><a href="#cb58-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Edge sample:"</span>)</span>
<span id="cb58-103"><a href="#cb58-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edges_df.head(<span class="dv">10</span>))</span>
<span id="cb58-104"><a href="#cb58-104" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Post count statistics:"</span>)</span>
<span id="cb58-105"><a href="#cb58-105" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edges_df[<span class="st">'post_count'</span>].describe())</span>
<span id="cb58-106"><a href="#cb58-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-107"><a href="#cb58-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-108"><a href="#cb58-108" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Creating a NetworkX Bipartite Graph</span></span>
<span id="cb58-109"><a href="#cb58-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-110"><a href="#cb58-110" aria-hidden="true" tabindex="-1"></a>We construct the two-mode network using NetworkX, with users and beer styles as the two node sets.</span>
<span id="cb58-111"><a href="#cb58-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-114"><a href="#cb58-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-115"><a href="#cb58-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: create-bipartite</span></span>
<span id="cb58-116"><a href="#cb58-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-117"><a href="#cb58-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty bipartite graph</span></span>
<span id="cb58-118"><a href="#cb58-118" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> nx.Graph()</span>
<span id="cb58-119"><a href="#cb58-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-120"><a href="#cb58-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Add user nodes (bipartite=0)</span></span>
<span id="cb58-121"><a href="#cb58-121" aria-hidden="true" tabindex="-1"></a>user_ids <span class="op">=</span> users_df[<span class="st">'user_id'</span>].tolist()</span>
<span id="cb58-122"><a href="#cb58-122" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> users_df.iterrows():</span>
<span id="cb58-123"><a href="#cb58-123" aria-hidden="true" tabindex="-1"></a>    B.add_node(row[<span class="st">'user_id'</span>],</span>
<span id="cb58-124"><a href="#cb58-124" aria-hidden="true" tabindex="-1"></a>               bipartite<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb58-125"><a href="#cb58-125" aria-hidden="true" tabindex="-1"></a>               node_type<span class="op">=</span><span class="st">'user'</span>,</span>
<span id="cb58-126"><a href="#cb58-126" aria-hidden="true" tabindex="-1"></a>               primary_community<span class="op">=</span>row[<span class="st">'primary_community'</span>],</span>
<span id="cb58-127"><a href="#cb58-127" aria-hidden="true" tabindex="-1"></a>               is_bridge<span class="op">=</span>row[<span class="st">'is_bridge'</span>],</span>
<span id="cb58-128"><a href="#cb58-128" aria-hidden="true" tabindex="-1"></a>               days_active<span class="op">=</span>row[<span class="st">'days_active'</span>],</span>
<span id="cb58-129"><a href="#cb58-129" aria-hidden="true" tabindex="-1"></a>               total_posts<span class="op">=</span>row[<span class="st">'total_posts'</span>])</span>
<span id="cb58-130"><a href="#cb58-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-131"><a href="#cb58-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Add style nodes (bipartite=1)</span></span>
<span id="cb58-132"><a href="#cb58-132" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> styles_df.iterrows():</span>
<span id="cb58-133"><a href="#cb58-133" aria-hidden="true" tabindex="-1"></a>    B.add_node(row[<span class="st">'style_name'</span>],</span>
<span id="cb58-134"><a href="#cb58-134" aria-hidden="true" tabindex="-1"></a>               bipartite<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb58-135"><a href="#cb58-135" aria-hidden="true" tabindex="-1"></a>               node_type<span class="op">=</span><span class="st">'style'</span>,</span>
<span id="cb58-136"><a href="#cb58-136" aria-hidden="true" tabindex="-1"></a>               community<span class="op">=</span>row[<span class="st">'community'</span>],</span>
<span id="cb58-137"><a href="#cb58-137" aria-hidden="true" tabindex="-1"></a>               popularity<span class="op">=</span>row[<span class="st">'popularity'</span>])</span>
<span id="cb58-138"><a href="#cb58-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-139"><a href="#cb58-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Add weighted edges</span></span>
<span id="cb58-140"><a href="#cb58-140" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> edges_df.iterrows():</span>
<span id="cb58-141"><a href="#cb58-141" aria-hidden="true" tabindex="-1"></a>    B.add_edge(row[<span class="st">'user_id'</span>], row[<span class="st">'beer_style'</span>], weight<span class="op">=</span>row[<span class="st">'post_count'</span>])</span>
<span id="cb58-142"><a href="#cb58-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-143"><a href="#cb58-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify bipartite structure</span></span>
<span id="cb58-144"><a href="#cb58-144" aria-hidden="true" tabindex="-1"></a>user_nodes <span class="op">=</span> {n <span class="cf">for</span> n, d <span class="kw">in</span> B.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">'bipartite'</span>] <span class="op">==</span> <span class="dv">0</span>}</span>
<span id="cb58-145"><a href="#cb58-145" aria-hidden="true" tabindex="-1"></a>style_nodes <span class="op">=</span> {n <span class="cf">for</span> n, d <span class="kw">in</span> B.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">'bipartite'</span>] <span class="op">==</span> <span class="dv">1</span>}</span>
<span id="cb58-146"><a href="#cb58-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-147"><a href="#cb58-147" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Bipartite Network Created"</span>)</span>
<span id="cb58-148"><a href="#cb58-148" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  User nodes: </span><span class="sc">{</span><span class="bu">len</span>(user_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-149"><a href="#cb58-149" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Style nodes: </span><span class="sc">{</span><span class="bu">len</span>(style_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-150"><a href="#cb58-150" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total edges: </span><span class="sc">{</span>B<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-151"><a href="#cb58-151" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Is bipartite: </span><span class="sc">{</span>bipartite<span class="sc">.</span>is_bipartite(B)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-152"><a href="#cb58-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-153"><a href="#cb58-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-156"><a href="#cb58-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-157"><a href="#cb58-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bipartite-stats</span></span>
<span id="cb58-158"><a href="#cb58-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-159"><a href="#cb58-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic bipartite network statistics</span></span>
<span id="cb58-160"><a href="#cb58-160" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bipartite Network Statistics:"</span>)</span>
<span id="cb58-161"><a href="#cb58-161" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Network density: </span><span class="sc">{</span>nx<span class="sc">.</span>density(B)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-162"><a href="#cb58-162" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Average degree (users): </span><span class="sc">{</span>np<span class="sc">.</span>mean([B.degree(n) <span class="cf">for</span> n <span class="kw">in</span> user_nodes])<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb58-163"><a href="#cb58-163" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Average degree (styles): </span><span class="sc">{</span>np<span class="sc">.</span>mean([B.degree(n) <span class="cf">for</span> n <span class="kw">in</span> style_nodes])<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb58-164"><a href="#cb58-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-165"><a href="#cb58-165" aria-hidden="true" tabindex="-1"></a><span class="co"># Degree distribution for styles</span></span>
<span id="cb58-166"><a href="#cb58-166" aria-hidden="true" tabindex="-1"></a>style_degrees <span class="op">=</span> [(n, B.degree(n)) <span class="cf">for</span> n <span class="kw">in</span> style_nodes]</span>
<span id="cb58-167"><a href="#cb58-167" aria-hidden="true" tabindex="-1"></a>style_degrees.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-168"><a href="#cb58-168" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Style engagement (degree):"</span>)</span>
<span id="cb58-169"><a href="#cb58-169" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> style, degree <span class="kw">in</span> style_degrees[:<span class="dv">10</span>]:</span>
<span id="cb58-170"><a href="#cb58-170" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>style<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>degree<span class="sc">}</span><span class="ss"> users"</span>)</span>
<span id="cb58-171"><a href="#cb58-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-172"><a href="#cb58-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-173"><a href="#cb58-173" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Projecting onto Users (One-Mode Network)</span></span>
<span id="cb58-174"><a href="#cb58-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-175"><a href="#cb58-175" aria-hidden="true" tabindex="-1"></a>We project the bipartite network onto the user node set using NetworkX's weighted projection. In the resulting one-mode network:</span>
<span id="cb58-176"><a href="#cb58-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-177"><a href="#cb58-177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Nodes** represent users (same as in the bipartite network)</span>
<span id="cb58-178"><a href="#cb58-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Edges** connect users who share at least one beer style interest</span>
<span id="cb58-179"><a href="#cb58-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Edge weights** equal the sum of the minimum participation weights across all shared styles (i.e., the overlap in attention)</span>
<span id="cb58-180"><a href="#cb58-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-181"><a href="#cb58-181" aria-hidden="true" tabindex="-1"></a>This transformation converts "who engages with what" into "who is similar to whom" based on revealed attention patterns.</span>
<span id="cb58-182"><a href="#cb58-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-185"><a href="#cb58-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-186"><a href="#cb58-186" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: project-users</span></span>
<span id="cb58-187"><a href="#cb58-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-188"><a href="#cb58-188" aria-hidden="true" tabindex="-1"></a><span class="co"># Project bipartite network onto users</span></span>
<span id="cb58-189"><a href="#cb58-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Using weighted projection where weight = sum of shared style participations</span></span>
<span id="cb58-190"><a href="#cb58-190" aria-hidden="true" tabindex="-1"></a>G_users <span class="op">=</span> bipartite.weighted_projected_graph(B, user_nodes)</span>
<span id="cb58-191"><a href="#cb58-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-192"><a href="#cb58-192" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"User Projection (One-Mode Network)"</span>)</span>
<span id="cb58-193"><a href="#cb58-193" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-194"><a href="#cb58-194" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-195"><a href="#cb58-195" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Density: </span><span class="sc">{</span>nx<span class="sc">.</span>density(G_users)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-196"><a href="#cb58-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-197"><a href="#cb58-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-200"><a href="#cb58-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-201"><a href="#cb58-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: projection-stats</span></span>
<span id="cb58-202"><a href="#cb58-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-203"><a href="#cb58-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze projected network</span></span>
<span id="cb58-204"><a href="#cb58-204" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Projected Network Statistics:"</span>)</span>
<span id="cb58-205"><a href="#cb58-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-206"><a href="#cb58-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Connectivity</span></span>
<span id="cb58-207"><a href="#cb58-207" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> nx.is_connected(G_users):</span>
<span id="cb58-208"><a href="#cb58-208" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Connected: Yes"</span>)</span>
<span id="cb58-209"><a href="#cb58-209" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Diameter: </span><span class="sc">{</span>nx<span class="sc">.</span>diameter(G_users)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-210"><a href="#cb58-210" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Average shortest path: </span><span class="sc">{</span>nx<span class="sc">.</span>average_shortest_path_length(G_users)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb58-211"><a href="#cb58-211" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb58-212"><a href="#cb58-212" aria-hidden="true" tabindex="-1"></a>    largest_cc <span class="op">=</span> <span class="bu">max</span>(nx.connected_components(G_users), key<span class="op">=</span><span class="bu">len</span>)</span>
<span id="cb58-213"><a href="#cb58-213" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Connected: No"</span>)</span>
<span id="cb58-214"><a href="#cb58-214" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of components: </span><span class="sc">{</span>nx<span class="sc">.</span>number_connected_components(G_users)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-215"><a href="#cb58-215" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Largest component: </span><span class="sc">{</span><span class="bu">len</span>(largest_cc)<span class="sc">}</span><span class="ss"> nodes"</span>)</span>
<span id="cb58-216"><a href="#cb58-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-217"><a href="#cb58-217" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering</span></span>
<span id="cb58-218"><a href="#cb58-218" aria-hidden="true" tabindex="-1"></a>avg_clustering <span class="op">=</span> nx.average_clustering(G_users)</span>
<span id="cb58-219"><a href="#cb58-219" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Average clustering coefficient: </span><span class="sc">{</span>avg_clustering<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-220"><a href="#cb58-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-221"><a href="#cb58-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Transitivity (global clustering)</span></span>
<span id="cb58-222"><a href="#cb58-222" aria-hidden="true" tabindex="-1"></a>transitivity <span class="op">=</span> nx.transitivity(G_users)</span>
<span id="cb58-223"><a href="#cb58-223" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Transitivity (global clustering): </span><span class="sc">{</span>transitivity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-224"><a href="#cb58-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-225"><a href="#cb58-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Degree statistics</span></span>
<span id="cb58-226"><a href="#cb58-226" aria-hidden="true" tabindex="-1"></a>degrees <span class="op">=</span> [d <span class="cf">for</span> n, d <span class="kw">in</span> G_users.degree()]</span>
<span id="cb58-227"><a href="#cb58-227" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Degree statistics:"</span>)</span>
<span id="cb58-228"><a href="#cb58-228" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Min: </span><span class="sc">{</span><span class="bu">min</span>(degrees)<span class="sc">}</span><span class="ss">, Max: </span><span class="sc">{</span><span class="bu">max</span>(degrees)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-229"><a href="#cb58-229" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean: </span><span class="sc">{</span>np<span class="sc">.</span>mean(degrees)<span class="sc">:.2f}</span><span class="ss">, Std: </span><span class="sc">{</span>np<span class="sc">.</span>std(degrees)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb58-230"><a href="#cb58-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-231"><a href="#cb58-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-234"><a href="#cb58-234" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-235"><a href="#cb58-235" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: small-world-check</span></span>
<span id="cb58-236"><a href="#cb58-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-237"><a href="#cb58-237" aria-hidden="true" tabindex="-1"></a><span class="co"># Small-world analysis</span></span>
<span id="cb58-238"><a href="#cb58-238" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Small-World Analysis:"</span>)</span>
<span id="cb58-239"><a href="#cb58-239" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> G_users.number_of_nodes()</span>
<span id="cb58-240"><a href="#cb58-240" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> G_users.number_of_edges()</span>
<span id="cb58-241"><a href="#cb58-241" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> m <span class="op">/</span> (n <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>))  <span class="co"># Edge probability</span></span>
<span id="cb58-242"><a href="#cb58-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-243"><a href="#cb58-243" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to random graph expectations</span></span>
<span id="cb58-244"><a href="#cb58-244" aria-hidden="true" tabindex="-1"></a>expected_clustering_random <span class="op">=</span> p</span>
<span id="cb58-245"><a href="#cb58-245" aria-hidden="true" tabindex="-1"></a>expected_path_random <span class="op">=</span> np.log(n) <span class="op">/</span> np.log(n <span class="op">*</span> p) <span class="cf">if</span> n <span class="op">*</span> p <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb58-246"><a href="#cb58-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-247"><a href="#cb58-247" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Actual clustering: </span><span class="sc">{</span>avg_clustering<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-248"><a href="#cb58-248" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Expected (random): </span><span class="sc">{</span>expected_clustering_random<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-249"><a href="#cb58-249" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Clustering ratio: </span><span class="sc">{</span>avg_clustering <span class="op">/</span> expected_clustering_random<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb58-250"><a href="#cb58-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-251"><a href="#cb58-251" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> nx.is_connected(G_users):</span>
<span id="cb58-252"><a href="#cb58-252" aria-hidden="true" tabindex="-1"></a>    actual_path <span class="op">=</span> nx.average_shortest_path_length(G_users)</span>
<span id="cb58-253"><a href="#cb58-253" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Actual avg path length: </span><span class="sc">{</span>actual_path<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb58-254"><a href="#cb58-254" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Expected (random): </span><span class="sc">{</span>expected_path_random<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb58-255"><a href="#cb58-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-256"><a href="#cb58-256" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Small-world coefficient (sigma)</span></span>
<span id="cb58-257"><a href="#cb58-257" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> (avg_clustering <span class="op">/</span> expected_clustering_random) <span class="op">/</span> (actual_path <span class="op">/</span> expected_path_random)</span>
<span id="cb58-258"><a href="#cb58-258" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Small-world coefficient (σ): </span><span class="sc">{</span>sigma<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb58-259"><a href="#cb58-259" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  (σ &gt; 1 indicates small-world structure)"</span>)</span>
<span id="cb58-260"><a href="#cb58-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-261"><a href="#cb58-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-262"><a href="#cb58-262" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. Network Visualization</span></span>
<span id="cb58-263"><a href="#cb58-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-264"><a href="#cb58-264" aria-hidden="true" tabindex="-1"></a>We visualize the projected user network, coloring nodes by their primary community affiliation.</span>
<span id="cb58-265"><a href="#cb58-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-268"><a href="#cb58-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-269"><a href="#cb58-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-prep</span></span>
<span id="cb58-270"><a href="#cb58-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-271"><a href="#cb58-271" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare node colors based on primary community</span></span>
<span id="cb58-272"><a href="#cb58-272" aria-hidden="true" tabindex="-1"></a>community_colors <span class="op">=</span> {</span>
<span id="cb58-273"><a href="#cb58-273" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="st">'#E41A1C'</span>,  <span class="co"># Red - Traditional British</span></span>
<span id="cb58-274"><a href="#cb58-274" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: <span class="st">'#377EB8'</span>,  <span class="co"># Blue - American Craft</span></span>
<span id="cb58-275"><a href="#cb58-275" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="st">'#4DAF4A'</span>,  <span class="co"># Green - Belgian</span></span>
<span id="cb58-276"><a href="#cb58-276" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>: <span class="st">'#984EA3'</span>,  <span class="co"># Purple - Dark/Roasted</span></span>
<span id="cb58-277"><a href="#cb58-277" aria-hidden="true" tabindex="-1"></a>    <span class="dv">5</span>: <span class="st">'#FF7F00'</span>,  <span class="co"># Orange - Lager</span></span>
<span id="cb58-278"><a href="#cb58-278" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-279"><a href="#cb58-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-280"><a href="#cb58-280" aria-hidden="true" tabindex="-1"></a>node_colors <span class="op">=</span> []</span>
<span id="cb58-281"><a href="#cb58-281" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> G_users.nodes():</span>
<span id="cb58-282"><a href="#cb58-282" aria-hidden="true" tabindex="-1"></a>    comm <span class="op">=</span> users_df[users_df[<span class="st">'user_id'</span>] <span class="op">==</span> node][<span class="st">'primary_community'</span>].values[<span class="dv">0</span>]</span>
<span id="cb58-283"><a href="#cb58-283" aria-hidden="true" tabindex="-1"></a>    node_colors.append(community_colors[comm])</span>
<span id="cb58-284"><a href="#cb58-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-285"><a href="#cb58-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify bridge users for highlighting</span></span>
<span id="cb58-286"><a href="#cb58-286" aria-hidden="true" tabindex="-1"></a>bridge_users <span class="op">=</span> <span class="bu">set</span>(users_df[users_df[<span class="st">'is_bridge'</span>] <span class="op">==</span> <span class="va">True</span>][<span class="st">'user_id'</span>])</span>
<span id="cb58-287"><a href="#cb58-287" aria-hidden="true" tabindex="-1"></a>node_sizes <span class="op">=</span> [<span class="dv">50</span> <span class="cf">if</span> n <span class="kw">in</span> bridge_users <span class="cf">else</span> <span class="dv">20</span> <span class="cf">for</span> n <span class="kw">in</span> G_users.nodes()]</span>
<span id="cb58-288"><a href="#cb58-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-289"><a href="#cb58-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-292"><a href="#cb58-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-293"><a href="#cb58-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-spring</span></span>
<span id="cb58-294"><a href="#cb58-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "User network with spring layout (colored by primary community)"</span></span>
<span id="cb58-295"><a href="#cb58-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-296"><a href="#cb58-296" aria-hidden="true" tabindex="-1"></a><span class="co"># Spring layout visualization (sample for readability)</span></span>
<span id="cb58-297"><a href="#cb58-297" aria-hidden="true" tabindex="-1"></a><span class="co"># For large networks, we sample nodes</span></span>
<span id="cb58-298"><a href="#cb58-298" aria-hidden="true" tabindex="-1"></a>sample_size <span class="op">=</span> <span class="bu">min</span>(<span class="dv">300</span>, G_users.number_of_nodes())</span>
<span id="cb58-299"><a href="#cb58-299" aria-hidden="true" tabindex="-1"></a>sample_nodes <span class="op">=</span> <span class="bu">list</span>(G_users.nodes())[:sample_size]</span>
<span id="cb58-300"><a href="#cb58-300" aria-hidden="true" tabindex="-1"></a>G_sample <span class="op">=</span> G_users.subgraph(sample_nodes)</span>
<span id="cb58-301"><a href="#cb58-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-302"><a href="#cb58-302" aria-hidden="true" tabindex="-1"></a><span class="co"># Get colors for sample</span></span>
<span id="cb58-303"><a href="#cb58-303" aria-hidden="true" tabindex="-1"></a>sample_colors <span class="op">=</span> [node_colors[<span class="bu">list</span>(G_users.nodes()).index(n)] <span class="cf">for</span> n <span class="kw">in</span> G_sample.nodes()]</span>
<span id="cb58-304"><a href="#cb58-304" aria-hidden="true" tabindex="-1"></a>sample_sizes <span class="op">=</span> [node_sizes[<span class="bu">list</span>(G_users.nodes()).index(n)] <span class="cf">for</span> n <span class="kw">in</span> G_sample.nodes()]</span>
<span id="cb58-305"><a href="#cb58-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-306"><a href="#cb58-306" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb58-307"><a href="#cb58-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-308"><a href="#cb58-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute layout</span></span>
<span id="cb58-309"><a href="#cb58-309" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> nx.spring_layout(G_sample, k<span class="op">=</span><span class="fl">0.3</span>, iterations<span class="op">=</span><span class="dv">50</span>, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb58-310"><a href="#cb58-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-311"><a href="#cb58-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw edges with low alpha</span></span>
<span id="cb58-312"><a href="#cb58-312" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_edges(G_sample, pos, alpha<span class="op">=</span><span class="fl">0.05</span>, edge_color<span class="op">=</span><span class="st">'gray'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb58-313"><a href="#cb58-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-314"><a href="#cb58-314" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw nodes</span></span>
<span id="cb58-315"><a href="#cb58-315" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx_nodes(G_sample, pos, node_color<span class="op">=</span>sample_colors,</span>
<span id="cb58-316"><a href="#cb58-316" aria-hidden="true" tabindex="-1"></a>                       node_size<span class="op">=</span>sample_sizes, alpha<span class="op">=</span><span class="fl">0.7</span>, ax<span class="op">=</span>ax)</span>
<span id="cb58-317"><a href="#cb58-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-318"><a href="#cb58-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend</span></span>
<span id="cb58-319"><a href="#cb58-319" aria-hidden="true" tabindex="-1"></a>legend_patches <span class="op">=</span> [</span>
<span id="cb58-320"><a href="#cb58-320" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">1</span>], label<span class="op">=</span><span class="st">'Traditional British'</span>),</span>
<span id="cb58-321"><a href="#cb58-321" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">2</span>], label<span class="op">=</span><span class="st">'American Craft'</span>),</span>
<span id="cb58-322"><a href="#cb58-322" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">3</span>], label<span class="op">=</span><span class="st">'Belgian'</span>),</span>
<span id="cb58-323"><a href="#cb58-323" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">4</span>], label<span class="op">=</span><span class="st">'Dark/Roasted'</span>),</span>
<span id="cb58-324"><a href="#cb58-324" aria-hidden="true" tabindex="-1"></a>    mpatches.Patch(color<span class="op">=</span>community_colors[<span class="dv">5</span>], label<span class="op">=</span><span class="st">'Lager'</span>),</span>
<span id="cb58-325"><a href="#cb58-325" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb58-326"><a href="#cb58-326" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>legend_patches, loc<span class="op">=</span><span class="st">'upper left'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb58-327"><a href="#cb58-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-328"><a href="#cb58-328" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Beer Enthusiast Network (sample of </span><span class="sc">{</span>sample_size<span class="sc">}</span><span class="ss"> users)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb58-329"><a href="#cb58-329" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb58-330"><a href="#cb58-330" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb58-331"><a href="#cb58-331" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb58-332"><a href="#cb58-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-333"><a href="#cb58-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-336"><a href="#cb58-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-337"><a href="#cb58-337" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: viz-degree-dist</span></span>
<span id="cb58-338"><a href="#cb58-338" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Degree distribution of the projected user network"</span></span>
<span id="cb58-339"><a href="#cb58-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-340"><a href="#cb58-340" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb58-341"><a href="#cb58-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-342"><a href="#cb58-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Degree histogram</span></span>
<span id="cb58-343"><a href="#cb58-343" aria-hidden="true" tabindex="-1"></a>degrees <span class="op">=</span> [d <span class="cf">for</span> n, d <span class="kw">in</span> G_users.degree()]</span>
<span id="cb58-344"><a href="#cb58-344" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].hist(degrees, bins<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb58-345"><a href="#cb58-345" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Degree'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb58-346"><a href="#cb58-346" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Frequency'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb58-347"><a href="#cb58-347" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Degree Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb58-348"><a href="#cb58-348" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(np.mean(degrees), color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'Mean: </span><span class="sc">{</span>np<span class="sc">.</span>mean(degrees)<span class="sc">:.0f}</span><span class="ss">'</span>)</span>
<span id="cb58-349"><a href="#cb58-349" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb58-350"><a href="#cb58-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-351"><a href="#cb58-351" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-log degree distribution</span></span>
<span id="cb58-352"><a href="#cb58-352" aria-hidden="true" tabindex="-1"></a>degree_counts <span class="op">=</span> Counter(degrees)</span>
<span id="cb58-353"><a href="#cb58-353" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">list</span>(degree_counts.keys())</span>
<span id="cb58-354"><a href="#cb58-354" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="bu">list</span>(degree_counts.values())</span>
<span id="cb58-355"><a href="#cb58-355" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].scatter(x, y, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb58-356"><a href="#cb58-356" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xscale(<span class="st">'log'</span>)</span>
<span id="cb58-357"><a href="#cb58-357" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_yscale(<span class="st">'log'</span>)</span>
<span id="cb58-358"><a href="#cb58-358" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Degree (log)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb58-359"><a href="#cb58-359" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Frequency (log)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb58-360"><a href="#cb58-360" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Degree Distribution (Log-Log)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb58-361"><a href="#cb58-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-362"><a href="#cb58-362" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb58-363"><a href="#cb58-363" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb58-364"><a href="#cb58-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-365"><a href="#cb58-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-366"><a href="#cb58-366" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5. Community Detection Algorithms</span></span>
<span id="cb58-367"><a href="#cb58-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-368"><a href="#cb58-368" aria-hidden="true" tabindex="-1"></a>We apply three modularity-based community detection algorithms to the projected network. These methods partition nodes into groups that maximize **modularity**—a measure comparing intra-community edge density to what would be expected in a random network with the same degree sequence.</span>
<span id="cb58-369"><a href="#cb58-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-370"><a href="#cb58-370" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Algorithm <span class="pp">|</span> Approach <span class="pp">|</span> Characteristics <span class="pp">|</span></span>
<span id="cb58-371"><a href="#cb58-371" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------|----------|-----------------|</span></span>
<span id="cb58-372"><a href="#cb58-372" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Louvain** <span class="pp">|</span> Greedy hierarchical optimization <span class="pp">|</span> Fast, deterministic (with seed), widely used <span class="pp">|</span></span>
<span id="cb58-373"><a href="#cb58-373" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Label Propagation** <span class="pp">|</span> Iterative neighbor voting <span class="pp">|</span> Very fast, but non-deterministic and may yield many small communities <span class="pp">|</span></span>
<span id="cb58-374"><a href="#cb58-374" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> **Greedy Modularity** <span class="pp">|</span> Agglomerative merging <span class="pp">|</span> Directly optimizes modularity, tends to find fewer, larger communities <span class="pp">|</span></span>
<span id="cb58-375"><a href="#cb58-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-376"><a href="#cb58-376" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5.1 Louvain Algorithm</span></span>
<span id="cb58-377"><a href="#cb58-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-380"><a href="#cb58-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-381"><a href="#cb58-381" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: louvain</span></span>
<span id="cb58-382"><a href="#cb58-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-383"><a href="#cb58-383" aria-hidden="true" tabindex="-1"></a><span class="co"># Louvain community detection</span></span>
<span id="cb58-384"><a href="#cb58-384" aria-hidden="true" tabindex="-1"></a>louvain_communities <span class="op">=</span> nx.community.louvain_communities(G_users, seed<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb58-385"><a href="#cb58-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-386"><a href="#cb58-386" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Louvain Community Detection"</span>)</span>
<span id="cb58-387"><a href="#cb58-387" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of communities: </span><span class="sc">{</span><span class="bu">len</span>(louvain_communities)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-388"><a href="#cb58-388" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Community sizes:"</span>)</span>
<span id="cb58-389"><a href="#cb58-389" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">sorted</span>(louvain_communities, key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)):</span>
<span id="cb58-390"><a href="#cb58-390" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Community </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(comm)<span class="sc">}</span><span class="ss"> users"</span>)</span>
<span id="cb58-391"><a href="#cb58-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-392"><a href="#cb58-392" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate modularity</span></span>
<span id="cb58-393"><a href="#cb58-393" aria-hidden="true" tabindex="-1"></a>louvain_modularity <span class="op">=</span> nx.community.modularity(G_users, louvain_communities)</span>
<span id="cb58-394"><a href="#cb58-394" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Modularity: </span><span class="sc">{</span>louvain_modularity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-395"><a href="#cb58-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-396"><a href="#cb58-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-399"><a href="#cb58-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-400"><a href="#cb58-400" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: louvain-analysis</span></span>
<span id="cb58-401"><a href="#cb58-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-402"><a href="#cb58-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze community composition</span></span>
<span id="cb58-403"><a href="#cb58-403" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Louvain Community Composition (by original community):"</span>)</span>
<span id="cb58-404"><a href="#cb58-404" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">sorted</span>(louvain_communities, key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">5</span>]):</span>
<span id="cb58-405"><a href="#cb58-405" aria-hidden="true" tabindex="-1"></a>    comm_users <span class="op">=</span> users_df[users_df[<span class="st">'user_id'</span>].isin(comm)]</span>
<span id="cb58-406"><a href="#cb58-406" aria-hidden="true" tabindex="-1"></a>    primary_dist <span class="op">=</span> comm_users[<span class="st">'primary_community'</span>].value_counts()</span>
<span id="cb58-407"><a href="#cb58-407" aria-hidden="true" tabindex="-1"></a>    dominant <span class="op">=</span> primary_dist.idxmax()</span>
<span id="cb58-408"><a href="#cb58-408" aria-hidden="true" tabindex="-1"></a>    dominant_pct <span class="op">=</span> primary_dist.<span class="bu">max</span>() <span class="op">/</span> <span class="bu">len</span>(comm) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb58-409"><a href="#cb58-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-410"><a href="#cb58-410" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Detected Community </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(comm)<span class="sc">}</span><span class="ss"> users):"</span>)</span>
<span id="cb58-411"><a href="#cb58-411" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Dominant original community: </span><span class="sc">{</span>dominant<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>dominant_pct<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb58-412"><a href="#cb58-412" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Distribution: </span><span class="sc">{</span><span class="bu">dict</span>(primary_dist.sort_index())<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-413"><a href="#cb58-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-414"><a href="#cb58-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-415"><a href="#cb58-415" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5.2 Label Propagation</span></span>
<span id="cb58-416"><a href="#cb58-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-419"><a href="#cb58-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-420"><a href="#cb58-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: label-prop</span></span>
<span id="cb58-421"><a href="#cb58-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-422"><a href="#cb58-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Label propagation</span></span>
<span id="cb58-423"><a href="#cb58-423" aria-hidden="true" tabindex="-1"></a>label_prop_communities <span class="op">=</span> <span class="bu">list</span>(nx.community.label_propagation_communities(G_users))</span>
<span id="cb58-424"><a href="#cb58-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-425"><a href="#cb58-425" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Label Propagation Community Detection"</span>)</span>
<span id="cb58-426"><a href="#cb58-426" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of communities: </span><span class="sc">{</span><span class="bu">len</span>(label_prop_communities)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-427"><a href="#cb58-427" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Community sizes (top 10):"</span>)</span>
<span id="cb58-428"><a href="#cb58-428" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">sorted</span>(label_prop_communities, key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">10</span>]):</span>
<span id="cb58-429"><a href="#cb58-429" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Community </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(comm)<span class="sc">}</span><span class="ss"> users"</span>)</span>
<span id="cb58-430"><a href="#cb58-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-431"><a href="#cb58-431" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate modularity</span></span>
<span id="cb58-432"><a href="#cb58-432" aria-hidden="true" tabindex="-1"></a>label_prop_modularity <span class="op">=</span> nx.community.modularity(G_users, label_prop_communities)</span>
<span id="cb58-433"><a href="#cb58-433" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Modularity: </span><span class="sc">{</span>label_prop_modularity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-434"><a href="#cb58-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-435"><a href="#cb58-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-436"><a href="#cb58-436" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5.3 Greedy Modularity Optimization</span></span>
<span id="cb58-437"><a href="#cb58-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-440"><a href="#cb58-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-441"><a href="#cb58-441" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: greedy-modularity</span></span>
<span id="cb58-442"><a href="#cb58-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-443"><a href="#cb58-443" aria-hidden="true" tabindex="-1"></a><span class="co"># Greedy modularity optimization</span></span>
<span id="cb58-444"><a href="#cb58-444" aria-hidden="true" tabindex="-1"></a>greedy_communities <span class="op">=</span> <span class="bu">list</span>(nx.community.greedy_modularity_communities(G_users))</span>
<span id="cb58-445"><a href="#cb58-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-446"><a href="#cb58-446" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Greedy Modularity Optimization"</span>)</span>
<span id="cb58-447"><a href="#cb58-447" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Number of communities: </span><span class="sc">{</span><span class="bu">len</span>(greedy_communities)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-448"><a href="#cb58-448" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Community sizes:"</span>)</span>
<span id="cb58-449"><a href="#cb58-449" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">sorted</span>(greedy_communities, key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)):</span>
<span id="cb58-450"><a href="#cb58-450" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    Community </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(comm)<span class="sc">}</span><span class="ss"> users"</span>)</span>
<span id="cb58-451"><a href="#cb58-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-452"><a href="#cb58-452" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate modularity</span></span>
<span id="cb58-453"><a href="#cb58-453" aria-hidden="true" tabindex="-1"></a>greedy_modularity <span class="op">=</span> nx.community.modularity(G_users, greedy_communities)</span>
<span id="cb58-454"><a href="#cb58-454" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Modularity: </span><span class="sc">{</span>greedy_modularity<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-455"><a href="#cb58-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-456"><a href="#cb58-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-457"><a href="#cb58-457" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5.4 Algorithm Comparison</span></span>
<span id="cb58-458"><a href="#cb58-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-461"><a href="#cb58-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-462"><a href="#cb58-462" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compare-algorithms</span></span>
<span id="cb58-463"><a href="#cb58-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparison of community detection algorithms"</span></span>
<span id="cb58-464"><a href="#cb58-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-465"><a href="#cb58-465" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary comparison</span></span>
<span id="cb58-466"><a href="#cb58-466" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {</span>
<span id="cb58-467"><a href="#cb58-467" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Algorithm'</span>: [<span class="st">'Louvain'</span>, <span class="st">'Label Propagation'</span>, <span class="st">'Greedy Modularity'</span>],</span>
<span id="cb58-468"><a href="#cb58-468" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Communities'</span>: [<span class="bu">len</span>(louvain_communities), <span class="bu">len</span>(label_prop_communities), <span class="bu">len</span>(greedy_communities)],</span>
<span id="cb58-469"><a href="#cb58-469" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Modularity'</span>: [louvain_modularity, label_prop_modularity, greedy_modularity],</span>
<span id="cb58-470"><a href="#cb58-470" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Largest Community'</span>: [</span>
<span id="cb58-471"><a href="#cb58-471" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="bu">len</span>(c) <span class="cf">for</span> c <span class="kw">in</span> louvain_communities),</span>
<span id="cb58-472"><a href="#cb58-472" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="bu">len</span>(c) <span class="cf">for</span> c <span class="kw">in</span> label_prop_communities),</span>
<span id="cb58-473"><a href="#cb58-473" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="bu">len</span>(c) <span class="cf">for</span> c <span class="kw">in</span> greedy_communities)</span>
<span id="cb58-474"><a href="#cb58-474" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb58-475"><a href="#cb58-475" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-476"><a href="#cb58-476" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb58-477"><a href="#cb58-477" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Algorithm Comparison:"</span>)</span>
<span id="cb58-478"><a href="#cb58-478" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(comparison_df.to_string(index<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb58-479"><a href="#cb58-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-480"><a href="#cb58-480" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb58-481"><a href="#cb58-481" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb58-482"><a href="#cb58-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-483"><a href="#cb58-483" aria-hidden="true" tabindex="-1"></a><span class="co"># Modularity comparison</span></span>
<span id="cb58-484"><a href="#cb58-484" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#2ecc71'</span>, <span class="st">'#3498db'</span>, <span class="st">'#e74c3c'</span>]</span>
<span id="cb58-485"><a href="#cb58-485" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].bar(results[<span class="st">'Algorithm'</span>], results[<span class="st">'Modularity'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb58-486"><a href="#cb58-486" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Modularity'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb58-487"><a href="#cb58-487" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Modularity by Algorithm'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb58-488"><a href="#cb58-488" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>, <span class="bu">max</span>(results[<span class="st">'Modularity'</span>]) <span class="op">*</span> <span class="fl">1.2</span>)</span>
<span id="cb58-489"><a href="#cb58-489" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, v <span class="kw">in</span> <span class="bu">enumerate</span>(results[<span class="st">'Modularity'</span>]):</span>
<span id="cb58-490"><a href="#cb58-490" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].text(i, v <span class="op">+</span> <span class="fl">0.01</span>, <span class="ss">f'</span><span class="sc">{</span>v<span class="sc">:.3f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb58-491"><a href="#cb58-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-492"><a href="#cb58-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Community count comparison</span></span>
<span id="cb58-493"><a href="#cb58-493" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].bar(results[<span class="st">'Algorithm'</span>], results[<span class="st">'Communities'</span>], color<span class="op">=</span>colors, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb58-494"><a href="#cb58-494" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Number of Communities'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb58-495"><a href="#cb58-495" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Communities Detected'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb58-496"><a href="#cb58-496" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, v <span class="kw">in</span> <span class="bu">enumerate</span>(results[<span class="st">'Communities'</span>]):</span>
<span id="cb58-497"><a href="#cb58-497" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>].text(i, v <span class="op">+</span> <span class="fl">0.5</span>, <span class="bu">str</span>(v), ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb58-498"><a href="#cb58-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-499"><a href="#cb58-499" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb58-500"><a href="#cb58-500" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb58-501"><a href="#cb58-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-502"><a href="#cb58-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-503"><a href="#cb58-503" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6. Results Summary</span></span>
<span id="cb58-504"><a href="#cb58-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-507"><a href="#cb58-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-508"><a href="#cb58-508" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summary</span></span>
<span id="cb58-509"><a href="#cb58-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-510"><a href="#cb58-510" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb58-511"><a href="#cb58-511" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NETWORK ANALYSIS SUMMARY"</span>)</span>
<span id="cb58-512"><a href="#cb58-512" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb58-513"><a href="#cb58-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-514"><a href="#cb58-514" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">1. BIPARTITE NETWORK"</span>)</span>
<span id="cb58-515"><a href="#cb58-515" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Users: </span><span class="sc">{</span><span class="bu">len</span>(user_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-516"><a href="#cb58-516" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Beer Styles: </span><span class="sc">{</span><span class="bu">len</span>(style_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-517"><a href="#cb58-517" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Edges: </span><span class="sc">{</span>B<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-518"><a href="#cb58-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-519"><a href="#cb58-519" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. PROJECTED USER NETWORK"</span>)</span>
<span id="cb58-520"><a href="#cb58-520" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Nodes: </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-521"><a href="#cb58-521" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Edges: </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-522"><a href="#cb58-522" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Density: </span><span class="sc">{</span>nx<span class="sc">.</span>density(G_users)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-523"><a href="#cb58-523" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Avg Clustering: </span><span class="sc">{</span>avg_clustering<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-524"><a href="#cb58-524" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> nx.is_connected(G_users):</span>
<span id="cb58-525"><a href="#cb58-525" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Avg Path Length: </span><span class="sc">{</span>nx<span class="sc">.</span>average_shortest_path_length(G_users)<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb58-526"><a href="#cb58-526" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - Diameter: </span><span class="sc">{</span>nx<span class="sc">.</span>diameter(G_users)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-527"><a href="#cb58-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-528"><a href="#cb58-528" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. SMALL-WORLD PROPERTIES"</span>)</span>
<span id="cb58-529"><a href="#cb58-529" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Clustering ratio (vs random): </span><span class="sc">{</span>avg_clustering <span class="op">/</span> expected_clustering_random<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb58-530"><a href="#cb58-530" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Network exhibits small-world structure: </span><span class="sc">{</span><span class="st">'Yes'</span> <span class="cf">if</span> avg_clustering <span class="op">/</span> expected_clustering_random <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">'No'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-531"><a href="#cb58-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-532"><a href="#cb58-532" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">4. COMMUNITY DETECTION"</span>)</span>
<span id="cb58-533"><a href="#cb58-533" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Best algorithm (by modularity): </span><span class="sc">{</span>comparison_df<span class="sc">.</span>loc[comparison_df[<span class="st">'Modularity'</span>].idxmax(), <span class="st">'Algorithm'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-534"><a href="#cb58-534" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Best modularity score: </span><span class="sc">{</span>comparison_df[<span class="st">'Modularity'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-535"><a href="#cb58-535" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"   - Consensus community count: ~</span><span class="sc">{</span><span class="bu">int</span>(np.median(results[<span class="st">'Communities'</span>]))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-536"><a href="#cb58-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-537"><a href="#cb58-537" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">5. KEY INSIGHTS"</span>)</span>
<span id="cb58-538"><a href="#cb58-538" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - The network shows clear community structure aligned with beer style families"</span>)</span>
<span id="cb58-539"><a href="#cb58-539" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - High clustering indicates users form cohesive interest groups"</span>)</span>
<span id="cb58-540"><a href="#cb58-540" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Short path lengths suggest bridging connections across communities"</span>)</span>
<span id="cb58-541"><a href="#cb58-541" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   - Community detection recovers the underlying style-based segmentation"</span>)</span>
<span id="cb58-542"><a href="#cb58-542" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb58-543"><a href="#cb58-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-544"><a href="#cb58-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-545"><a href="#cb58-545" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7. Writing the Projected Network to File</span></span>
<span id="cb58-546"><a href="#cb58-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-547"><a href="#cb58-547" aria-hidden="true" tabindex="-1"></a>We save the projected user network in multiple formats for further analysis.</span>
<span id="cb58-548"><a href="#cb58-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-551"><a href="#cb58-551" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-552"><a href="#cb58-552" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: write-network</span></span>
<span id="cb58-553"><a href="#cb58-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-554"><a href="#cb58-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Create node attributes dataframe for the projected network</span></span>
<span id="cb58-555"><a href="#cb58-555" aria-hidden="true" tabindex="-1"></a>node_attrs <span class="op">=</span> []</span>
<span id="cb58-556"><a href="#cb58-556" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> G_users.nodes():</span>
<span id="cb58-557"><a href="#cb58-557" aria-hidden="true" tabindex="-1"></a>    user_data <span class="op">=</span> users_df[users_df[<span class="st">'user_id'</span>] <span class="op">==</span> node].iloc[<span class="dv">0</span>]</span>
<span id="cb58-558"><a href="#cb58-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-559"><a href="#cb58-559" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find Louvain community assignment</span></span>
<span id="cb58-560"><a href="#cb58-560" aria-hidden="true" tabindex="-1"></a>    louvain_comm <span class="op">=</span> <span class="va">None</span></span>
<span id="cb58-561"><a href="#cb58-561" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, comm <span class="kw">in</span> <span class="bu">enumerate</span>(louvain_communities):</span>
<span id="cb58-562"><a href="#cb58-562" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node <span class="kw">in</span> comm:</span>
<span id="cb58-563"><a href="#cb58-563" aria-hidden="true" tabindex="-1"></a>            louvain_comm <span class="op">=</span> i</span>
<span id="cb58-564"><a href="#cb58-564" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb58-565"><a href="#cb58-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-566"><a href="#cb58-566" aria-hidden="true" tabindex="-1"></a>    node_attrs.append({</span>
<span id="cb58-567"><a href="#cb58-567" aria-hidden="true" tabindex="-1"></a>        <span class="st">'id'</span>: node,</span>
<span id="cb58-568"><a href="#cb58-568" aria-hidden="true" tabindex="-1"></a>        <span class="st">'primary_community'</span>: user_data[<span class="st">'primary_community'</span>],</span>
<span id="cb58-569"><a href="#cb58-569" aria-hidden="true" tabindex="-1"></a>        <span class="st">'is_bridge'</span>: user_data[<span class="st">'is_bridge'</span>],</span>
<span id="cb58-570"><a href="#cb58-570" aria-hidden="true" tabindex="-1"></a>        <span class="st">'days_active'</span>: user_data[<span class="st">'days_active'</span>],</span>
<span id="cb58-571"><a href="#cb58-571" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_posts'</span>: user_data[<span class="st">'total_posts'</span>],</span>
<span id="cb58-572"><a href="#cb58-572" aria-hidden="true" tabindex="-1"></a>        <span class="st">'degree'</span>: G_users.degree(node),</span>
<span id="cb58-573"><a href="#cb58-573" aria-hidden="true" tabindex="-1"></a>        <span class="st">'louvain_community'</span>: louvain_comm</span>
<span id="cb58-574"><a href="#cb58-574" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb58-575"><a href="#cb58-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-576"><a href="#cb58-576" aria-hidden="true" tabindex="-1"></a>nodes_export_df <span class="op">=</span> pd.DataFrame(node_attrs)</span>
<span id="cb58-577"><a href="#cb58-577" aria-hidden="true" tabindex="-1"></a>nodes_export_df.to_csv(<span class="st">'../../../data/beerAdvocate/projected_nodes.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb58-578"><a href="#cb58-578" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Saved: projected_nodes.csv"</span>)</span>
<span id="cb58-579"><a href="#cb58-579" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nodes_export_df.head())</span>
<span id="cb58-580"><a href="#cb58-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-581"><a href="#cb58-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-584"><a href="#cb58-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-585"><a href="#cb58-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: write-edges</span></span>
<span id="cb58-586"><a href="#cb58-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-587"><a href="#cb58-587" aria-hidden="true" tabindex="-1"></a><span class="co"># Export edges with weights</span></span>
<span id="cb58-588"><a href="#cb58-588" aria-hidden="true" tabindex="-1"></a>edges_export <span class="op">=</span> []</span>
<span id="cb58-589"><a href="#cb58-589" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> u, v, d <span class="kw">in</span> G_users.edges(data<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb58-590"><a href="#cb58-590" aria-hidden="true" tabindex="-1"></a>    edges_export.append({</span>
<span id="cb58-591"><a href="#cb58-591" aria-hidden="true" tabindex="-1"></a>        <span class="st">'source'</span>: u,</span>
<span id="cb58-592"><a href="#cb58-592" aria-hidden="true" tabindex="-1"></a>        <span class="st">'target'</span>: v,</span>
<span id="cb58-593"><a href="#cb58-593" aria-hidden="true" tabindex="-1"></a>        <span class="st">'weight'</span>: d.get(<span class="st">'weight'</span>, <span class="dv">1</span>)</span>
<span id="cb58-594"><a href="#cb58-594" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb58-595"><a href="#cb58-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-596"><a href="#cb58-596" aria-hidden="true" tabindex="-1"></a>edges_export_df <span class="op">=</span> pd.DataFrame(edges_export)</span>
<span id="cb58-597"><a href="#cb58-597" aria-hidden="true" tabindex="-1"></a>edges_export_df.to_csv(<span class="st">'../../../data/beerAdvocate/projected_edges.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb58-598"><a href="#cb58-598" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Saved: projected_edges.csv (</span><span class="sc">{</span><span class="bu">len</span>(edges_export_df)<span class="sc">}</span><span class="ss"> edges)"</span>)</span>
<span id="cb58-599"><a href="#cb58-599" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edges_export_df.head())</span>
<span id="cb58-600"><a href="#cb58-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-601"><a href="#cb58-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-604"><a href="#cb58-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-605"><a href="#cb58-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: write-graphml</span></span>
<span id="cb58-606"><a href="#cb58-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-607"><a href="#cb58-607" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as GraphML for compatibility with other tools</span></span>
<span id="cb58-608"><a href="#cb58-608" aria-hidden="true" tabindex="-1"></a>nx.write_graphml(G_users, <span class="st">'../../../data/beerAdvocate/user_network.graphml'</span>)</span>
<span id="cb58-609"><a href="#cb58-609" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Saved: user_network.graphml"</span>)</span>
<span id="cb58-610"><a href="#cb58-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-611"><a href="#cb58-611" aria-hidden="true" tabindex="-1"></a><span class="co"># Also save edge list format</span></span>
<span id="cb58-612"><a href="#cb58-612" aria-hidden="true" tabindex="-1"></a>nx.write_edgelist(G_users, <span class="st">'../../../data/beerAdvocate/user_network.edgelist'</span>, data<span class="op">=</span>[<span class="st">'weight'</span>])</span>
<span id="cb58-613"><a href="#cb58-613" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Saved: user_network.edgelist"</span>)</span>
<span id="cb58-614"><a href="#cb58-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-615"><a href="#cb58-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-616"><a href="#cb58-616" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8. Reading the Network Back</span></span>
<span id="cb58-617"><a href="#cb58-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-618"><a href="#cb58-618" aria-hidden="true" tabindex="-1"></a>We verify the saved files by reading them back and reconstructing the network.</span>
<span id="cb58-619"><a href="#cb58-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-622"><a href="#cb58-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-623"><a href="#cb58-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: read-network</span></span>
<span id="cb58-624"><a href="#cb58-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-625"><a href="#cb58-625" aria-hidden="true" tabindex="-1"></a><span class="co"># Read from CSV files</span></span>
<span id="cb58-626"><a href="#cb58-626" aria-hidden="true" tabindex="-1"></a>nodes_read <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/projected_nodes.csv'</span>)</span>
<span id="cb58-627"><a href="#cb58-627" aria-hidden="true" tabindex="-1"></a>edges_read <span class="op">=</span> pd.read_csv(<span class="st">'../../../data/beerAdvocate/projected_edges.csv'</span>)</span>
<span id="cb58-628"><a href="#cb58-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-629"><a href="#cb58-629" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Reading network from CSV files..."</span>)</span>
<span id="cb58-630"><a href="#cb58-630" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span><span class="bu">len</span>(nodes_read)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-631"><a href="#cb58-631" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span><span class="bu">len</span>(edges_read)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-632"><a href="#cb58-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-633"><a href="#cb58-633" aria-hidden="true" tabindex="-1"></a><span class="co"># Reconstruct NetworkX graph</span></span>
<span id="cb58-634"><a href="#cb58-634" aria-hidden="true" tabindex="-1"></a>G_reconstructed <span class="op">=</span> nx.Graph()</span>
<span id="cb58-635"><a href="#cb58-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-636"><a href="#cb58-636" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nodes with attributes</span></span>
<span id="cb58-637"><a href="#cb58-637" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> nodes_read.iterrows():</span>
<span id="cb58-638"><a href="#cb58-638" aria-hidden="true" tabindex="-1"></a>    G_reconstructed.add_node(row[<span class="st">'id'</span>],</span>
<span id="cb58-639"><a href="#cb58-639" aria-hidden="true" tabindex="-1"></a>                             primary_community<span class="op">=</span>row[<span class="st">'primary_community'</span>],</span>
<span id="cb58-640"><a href="#cb58-640" aria-hidden="true" tabindex="-1"></a>                             is_bridge<span class="op">=</span>row[<span class="st">'is_bridge'</span>],</span>
<span id="cb58-641"><a href="#cb58-641" aria-hidden="true" tabindex="-1"></a>                             degree<span class="op">=</span>row[<span class="st">'degree'</span>],</span>
<span id="cb58-642"><a href="#cb58-642" aria-hidden="true" tabindex="-1"></a>                             louvain_community<span class="op">=</span>row[<span class="st">'louvain_community'</span>])</span>
<span id="cb58-643"><a href="#cb58-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-644"><a href="#cb58-644" aria-hidden="true" tabindex="-1"></a><span class="co"># Add edges with weights</span></span>
<span id="cb58-645"><a href="#cb58-645" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> edges_read.iterrows():</span>
<span id="cb58-646"><a href="#cb58-646" aria-hidden="true" tabindex="-1"></a>    G_reconstructed.add_edge(row[<span class="st">'source'</span>], row[<span class="st">'target'</span>], weight<span class="op">=</span>row[<span class="st">'weight'</span>])</span>
<span id="cb58-647"><a href="#cb58-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-648"><a href="#cb58-648" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Reconstructed graph:"</span>)</span>
<span id="cb58-649"><a href="#cb58-649" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span>G_reconstructed<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-650"><a href="#cb58-650" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>G_reconstructed<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-651"><a href="#cb58-651" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Matches original: </span><span class="sc">{</span>G_reconstructed<span class="sc">.</span>number_of_nodes() <span class="op">==</span> G_users<span class="sc">.</span>number_of_nodes() <span class="kw">and</span> G_reconstructed<span class="sc">.</span>number_of_edges() <span class="op">==</span> G_users<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-652"><a href="#cb58-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-653"><a href="#cb58-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-656"><a href="#cb58-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-657"><a href="#cb58-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: read-graphml</span></span>
<span id="cb58-658"><a href="#cb58-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-659"><a href="#cb58-659" aria-hidden="true" tabindex="-1"></a><span class="co"># Read from GraphML</span></span>
<span id="cb58-660"><a href="#cb58-660" aria-hidden="true" tabindex="-1"></a>G_from_graphml <span class="op">=</span> nx.read_graphml(<span class="st">'../../../data/beerAdvocate/user_network.graphml'</span>)</span>
<span id="cb58-661"><a href="#cb58-661" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Read from GraphML:"</span>)</span>
<span id="cb58-662"><a href="#cb58-662" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span>G_from_graphml<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-663"><a href="#cb58-663" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>G_from_graphml<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-664"><a href="#cb58-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-665"><a href="#cb58-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-666"><a href="#cb58-666" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9. Graph-Tool Network Instantiation</span></span>
<span id="cb58-667"><a href="#cb58-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-668"><a href="#cb58-668" aria-hidden="true" tabindex="-1"></a>We now convert the network to <span class="co">[</span><span class="ot">graph-tool</span><span class="co">](https://graph-tool.skewed.de/)</span> format for advanced analysis. Graph-tool is a highly efficient C++/Python library for network analysis that provides:</span>
<span id="cb58-669"><a href="#cb58-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-670"><a href="#cb58-670" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Performance**: Orders of magnitude faster than pure Python implementations</span>
<span id="cb58-671"><a href="#cb58-671" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Stochastic Block Models**: State-of-the-art Bayesian community detection</span>
<span id="cb58-672"><a href="#cb58-672" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Property maps**: Efficient storage of node/edge attributes</span>
<span id="cb58-673"><a href="#cb58-673" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Visualization**: Publication-quality network drawings</span>
<span id="cb58-674"><a href="#cb58-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-675"><a href="#cb58-675" aria-hidden="true" tabindex="-1"></a>The conversion preserves all node attributes (community labels, bridge status) and edge weights from the NetworkX graph.</span>
<span id="cb58-676"><a href="#cb58-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-679"><a href="#cb58-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-680"><a href="#cb58-680" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: graphtool-setup</span></span>
<span id="cb58-681"><a href="#cb58-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-682"><a href="#cb58-682" aria-hidden="true" tabindex="-1"></a><span class="co"># Import graph-tool</span></span>
<span id="cb58-683"><a href="#cb58-683" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb58-684"><a href="#cb58-684" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> graph_tool.<span class="bu">all</span> <span class="im">as</span> gt</span>
<span id="cb58-685"><a href="#cb58-685" aria-hidden="true" tabindex="-1"></a>    GRAPH_TOOL_AVAILABLE <span class="op">=</span> <span class="va">True</span></span>
<span id="cb58-686"><a href="#cb58-686" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"graph-tool version: </span><span class="sc">{</span>gt<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-687"><a href="#cb58-687" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb58-688"><a href="#cb58-688" aria-hidden="true" tabindex="-1"></a>    GRAPH_TOOL_AVAILABLE <span class="op">=</span> <span class="va">False</span></span>
<span id="cb58-689"><a href="#cb58-689" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"graph-tool is not installed."</span>)</span>
<span id="cb58-690"><a href="#cb58-690" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"To install: conda install -c conda-forge graph-tool"</span>)</span>
<span id="cb58-691"><a href="#cb58-691" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Or see: https://graph-tool.skewed.de/"</span>)</span>
<span id="cb58-692"><a href="#cb58-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-693"><a href="#cb58-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-696"><a href="#cb58-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-697"><a href="#cb58-697" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: graphtool-convert</span></span>
<span id="cb58-698"><a href="#cb58-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-699"><a href="#cb58-699" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb58-700"><a href="#cb58-700" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create graph-tool graph</span></span>
<span id="cb58-701"><a href="#cb58-701" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> gt.Graph(directed<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb58-702"><a href="#cb58-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-703"><a href="#cb58-703" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create vertex property map for node IDs</span></span>
<span id="cb58-704"><a href="#cb58-704" aria-hidden="true" tabindex="-1"></a>    v_id <span class="op">=</span> g.new_vertex_property(<span class="st">"string"</span>)</span>
<span id="cb58-705"><a href="#cb58-705" aria-hidden="true" tabindex="-1"></a>    v_primary_comm <span class="op">=</span> g.new_vertex_property(<span class="st">"int"</span>)</span>
<span id="cb58-706"><a href="#cb58-706" aria-hidden="true" tabindex="-1"></a>    v_is_bridge <span class="op">=</span> g.new_vertex_property(<span class="st">"bool"</span>)</span>
<span id="cb58-707"><a href="#cb58-707" aria-hidden="true" tabindex="-1"></a>    v_louvain <span class="op">=</span> g.new_vertex_property(<span class="st">"int"</span>)</span>
<span id="cb58-708"><a href="#cb58-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-709"><a href="#cb58-709" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create edge property map for weights</span></span>
<span id="cb58-710"><a href="#cb58-710" aria-hidden="true" tabindex="-1"></a>    e_weight <span class="op">=</span> g.new_edge_property(<span class="st">"double"</span>)</span>
<span id="cb58-711"><a href="#cb58-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-712"><a href="#cb58-712" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map from node ID to vertex</span></span>
<span id="cb58-713"><a href="#cb58-713" aria-hidden="true" tabindex="-1"></a>    node_to_vertex <span class="op">=</span> {}</span>
<span id="cb58-714"><a href="#cb58-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-715"><a href="#cb58-715" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add vertices</span></span>
<span id="cb58-716"><a href="#cb58-716" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> nodes_read.iterrows():</span>
<span id="cb58-717"><a href="#cb58-717" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> g.add_vertex()</span>
<span id="cb58-718"><a href="#cb58-718" aria-hidden="true" tabindex="-1"></a>        node_to_vertex[row[<span class="st">'id'</span>]] <span class="op">=</span> v</span>
<span id="cb58-719"><a href="#cb58-719" aria-hidden="true" tabindex="-1"></a>        v_id[v] <span class="op">=</span> row[<span class="st">'id'</span>]</span>
<span id="cb58-720"><a href="#cb58-720" aria-hidden="true" tabindex="-1"></a>        v_primary_comm[v] <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">'primary_community'</span>])</span>
<span id="cb58-721"><a href="#cb58-721" aria-hidden="true" tabindex="-1"></a>        v_is_bridge[v] <span class="op">=</span> <span class="bu">bool</span>(row[<span class="st">'is_bridge'</span>])</span>
<span id="cb58-722"><a href="#cb58-722" aria-hidden="true" tabindex="-1"></a>        v_louvain[v] <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">'louvain_community'</span>])</span>
<span id="cb58-723"><a href="#cb58-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-724"><a href="#cb58-724" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add edges</span></span>
<span id="cb58-725"><a href="#cb58-725" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> edges_read.iterrows():</span>
<span id="cb58-726"><a href="#cb58-726" aria-hidden="true" tabindex="-1"></a>        e <span class="op">=</span> g.add_edge(node_to_vertex[row[<span class="st">'source'</span>]],</span>
<span id="cb58-727"><a href="#cb58-727" aria-hidden="true" tabindex="-1"></a>                       node_to_vertex[row[<span class="st">'target'</span>]])</span>
<span id="cb58-728"><a href="#cb58-728" aria-hidden="true" tabindex="-1"></a>        e_weight[e] <span class="op">=</span> row[<span class="st">'weight'</span>]</span>
<span id="cb58-729"><a href="#cb58-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-730"><a href="#cb58-730" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set as internal properties</span></span>
<span id="cb58-731"><a href="#cb58-731" aria-hidden="true" tabindex="-1"></a>    g.vertex_properties[<span class="st">"id"</span>] <span class="op">=</span> v_id</span>
<span id="cb58-732"><a href="#cb58-732" aria-hidden="true" tabindex="-1"></a>    g.vertex_properties[<span class="st">"primary_community"</span>] <span class="op">=</span> v_primary_comm</span>
<span id="cb58-733"><a href="#cb58-733" aria-hidden="true" tabindex="-1"></a>    g.vertex_properties[<span class="st">"is_bridge"</span>] <span class="op">=</span> v_is_bridge</span>
<span id="cb58-734"><a href="#cb58-734" aria-hidden="true" tabindex="-1"></a>    g.vertex_properties[<span class="st">"louvain_community"</span>] <span class="op">=</span> v_louvain</span>
<span id="cb58-735"><a href="#cb58-735" aria-hidden="true" tabindex="-1"></a>    g.edge_properties[<span class="st">"weight"</span>] <span class="op">=</span> e_weight</span>
<span id="cb58-736"><a href="#cb58-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-737"><a href="#cb58-737" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Graph-tool network created:"</span>)</span>
<span id="cb58-738"><a href="#cb58-738" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Vertices: </span><span class="sc">{</span>g<span class="sc">.</span>num_vertices()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-739"><a href="#cb58-739" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>g<span class="sc">.</span>num_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-740"><a href="#cb58-740" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb58-741"><a href="#cb58-741" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Skipping graph-tool conversion (not installed)"</span>)</span>
<span id="cb58-742"><a href="#cb58-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-743"><a href="#cb58-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-744"><a href="#cb58-744" aria-hidden="true" tabindex="-1"></a><span class="fu">## 10. Stochastic Weighted Block Model</span></span>
<span id="cb58-745"><a href="#cb58-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-746"><a href="#cb58-746" aria-hidden="true" tabindex="-1"></a>The **Stochastic Block Model (SBM)** is a generative model for networks that assumes:</span>
<span id="cb58-747"><a href="#cb58-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-748"><a href="#cb58-748" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Nodes belong to latent groups (blocks)</span>
<span id="cb58-749"><a href="#cb58-749" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>The probability of an edge between two nodes depends only on their block memberships</span>
<span id="cb58-750"><a href="#cb58-750" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Edge weights follow a distribution parameterized by block membership</span>
<span id="cb58-751"><a href="#cb58-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-752"><a href="#cb58-752" aria-hidden="true" tabindex="-1"></a>Unlike modularity-based methods that optimize a single objective, the SBM uses **Bayesian inference** to find the partition that best compresses the network data (minimum description length principle). This approach:</span>
<span id="cb58-753"><a href="#cb58-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-754"><a href="#cb58-754" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Automatically determines the optimal number of communities</span>
<span id="cb58-755"><a href="#cb58-755" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Avoids overfitting by penalizing model complexity</span>
<span id="cb58-756"><a href="#cb58-756" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Provides a principled null model for statistical testing</span>
<span id="cb58-757"><a href="#cb58-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-758"><a href="#cb58-758" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hierarchical Nested SBM</span></span>
<span id="cb58-759"><a href="#cb58-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-760"><a href="#cb58-760" aria-hidden="true" tabindex="-1"></a>Graph-tool implements a **hierarchical nested SBM** where blocks themselves are recursively grouped into higher-level blocks, revealing multi-scale community structure. The fitting procedure involves:</span>
<span id="cb58-761"><a href="#cb58-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-762"><a href="#cb58-762" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Initial optimization**: <span class="in">`minimize_nested_blockmodel_dl()`</span> finds a good starting partition by minimizing the description length (entropy)</span>
<span id="cb58-763"><a href="#cb58-763" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**MCMC refinement**: <span class="in">`multiflip_mcmc_sweep()`</span> performs merge-split moves to escape local minima and improve the solution</span>
<span id="cb58-764"><a href="#cb58-764" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Weight modeling**: Edge weights are modeled using a <span class="in">`real-exponential`</span> distribution appropriate for continuous positive values (post counts)</span>
<span id="cb58-765"><a href="#cb58-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-766"><a href="#cb58-766" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting Output</span></span>
<span id="cb58-767"><a href="#cb58-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-768"><a href="#cb58-768" aria-hidden="true" tabindex="-1"></a>The model output includes:</span>
<span id="cb58-769"><a href="#cb58-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-770"><a href="#cb58-770" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Description length**: Total bits needed to encode the network given the model (lower = better fit, but penalizes complexity)</span>
<span id="cb58-771"><a href="#cb58-771" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Hierarchy levels**: Number of nested block levels discovered</span>
<span id="cb58-772"><a href="#cb58-772" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Block assignments**: Which block each node belongs to at each level</span>
<span id="cb58-773"><a href="#cb58-773" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Block sizes**: Distribution of nodes across blocks</span>
<span id="cb58-774"><a href="#cb58-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-775"><a href="#cb58-775" aria-hidden="true" tabindex="-1"></a>The weighted SBM approach follows <span class="co">[</span><span class="ot">Peixoto (2018)</span><span class="co">](https://doi.org/10.1103/PhysRevE.97.012306)</span>, which extends the nonparametric SBM framework to incorporate edge weights through microcanonical distributions.</span>
<span id="cb58-776"><a href="#cb58-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-777"><a href="#cb58-777" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb58-778"><a href="#cb58-778" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reference</span></span>
<span id="cb58-779"><a href="#cb58-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-780"><a href="#cb58-780" aria-hidden="true" tabindex="-1"></a>Peixoto, T. P. (2018). Nonparametric weighted stochastic block models. *Physical Review E*, 97(1), 012306. <span class="co">[</span><span class="ot">doi:10.1103/PhysRevE.97.012306</span><span class="co">](https://doi.org/10.1103/PhysRevE.97.012306)</span> | <span class="co">[</span><span class="ot">arXiv:1708.01432</span><span class="co">](https://arxiv.org/abs/1708.01432)</span></span>
<span id="cb58-781"><a href="#cb58-781" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb58-782"><a href="#cb58-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-785"><a href="#cb58-785" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-786"><a href="#cb58-786" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sbm-fit</span></span>
<span id="cb58-787"><a href="#cb58-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-788"><a href="#cb58-788" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb58-789"><a href="#cb58-789" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Fitting Hierarchical Nested Stochastic Block Model..."</span>)</span>
<span id="cb58-790"><a href="#cb58-790" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"(This may take a few minutes for large networks)</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb58-791"><a href="#cb58-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-792"><a href="#cb58-792" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit weighted hierarchical nested SBM using minimize_nested_blockmodel_dl</span></span>
<span id="cb58-793"><a href="#cb58-793" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This finds optimal hierarchical partition by minimizing description length</span></span>
<span id="cb58-794"><a href="#cb58-794" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The nested model automatically discovers multiple levels of community structure</span></span>
<span id="cb58-795"><a href="#cb58-795" aria-hidden="true" tabindex="-1"></a>    nested_state <span class="op">=</span> gt.minimize_nested_blockmodel_dl(</span>
<span id="cb58-796"><a href="#cb58-796" aria-hidden="true" tabindex="-1"></a>        g,</span>
<span id="cb58-797"><a href="#cb58-797" aria-hidden="true" tabindex="-1"></a>        state_args<span class="op">=</span><span class="bu">dict</span>(recs<span class="op">=</span>[e_weight], rec_types<span class="op">=</span>[<span class="st">"real-exponential"</span>])</span>
<span id="cb58-798"><a href="#cb58-798" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-799"><a href="#cb58-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-800"><a href="#cb58-800" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Initial description length: </span><span class="sc">{</span>nested_state<span class="sc">.</span>entropy()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb58-801"><a href="#cb58-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-802"><a href="#cb58-802" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Improve solution with merge-split MCMC sweeps</span></span>
<span id="cb58-803"><a href="#cb58-803" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Refining solution with merge-split MCMC..."</span>)</span>
<span id="cb58-804"><a href="#cb58-804" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>):</span>
<span id="cb58-805"><a href="#cb58-805" aria-hidden="true" tabindex="-1"></a>        ret <span class="op">=</span> nested_state.multiflip_mcmc_sweep(niter<span class="op">=</span><span class="dv">10</span>, beta<span class="op">=</span>np.inf)</span>
<span id="cb58-806"><a href="#cb58-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-807"><a href="#cb58-807" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Refined description length: </span><span class="sc">{</span>nested_state<span class="sc">.</span>entropy()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb58-808"><a href="#cb58-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-809"><a href="#cb58-809" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the hierarchy of block states</span></span>
<span id="cb58-810"><a href="#cb58-810" aria-hidden="true" tabindex="-1"></a>    levels <span class="op">=</span> nested_state.get_levels()</span>
<span id="cb58-811"><a href="#cb58-811" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Hierarchical SBM Results:"</span>)</span>
<span id="cb58-812"><a href="#cb58-812" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of hierarchy levels: </span><span class="sc">{</span><span class="bu">len</span>(levels)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-813"><a href="#cb58-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-814"><a href="#cb58-814" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Hierarchy structure:"</span>)</span>
<span id="cb58-815"><a href="#cb58-815" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, level_state <span class="kw">in</span> <span class="bu">enumerate</span>(levels):</span>
<span id="cb58-816"><a href="#cb58-816" aria-hidden="true" tabindex="-1"></a>        level_blocks <span class="op">=</span> level_state.get_blocks()</span>
<span id="cb58-817"><a href="#cb58-817" aria-hidden="true" tabindex="-1"></a>        level_block_counts <span class="op">=</span> Counter(level_blocks[v] <span class="cf">for</span> v <span class="kw">in</span> level_state.g.vertices())</span>
<span id="cb58-818"><a href="#cb58-818" aria-hidden="true" tabindex="-1"></a>        n_level_blocks <span class="op">=</span> <span class="bu">len</span>(level_block_counts)</span>
<span id="cb58-819"><a href="#cb58-819" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Level </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>level_state<span class="sc">.</span>g<span class="sc">.</span>num_vertices()<span class="sc">}</span><span class="ss"> nodes → </span><span class="sc">{</span>n_level_blocks<span class="sc">}</span><span class="ss"> blocks"</span>)</span>
<span id="cb58-820"><a href="#cb58-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-821"><a href="#cb58-821" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get bottom-level (finest) block assignments for nodes</span></span>
<span id="cb58-822"><a href="#cb58-822" aria-hidden="true" tabindex="-1"></a>    bottom_state <span class="op">=</span> levels[<span class="dv">0</span>]</span>
<span id="cb58-823"><a href="#cb58-823" aria-hidden="true" tabindex="-1"></a>    blocks <span class="op">=</span> bottom_state.get_blocks()</span>
<span id="cb58-824"><a href="#cb58-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-825"><a href="#cb58-825" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count blocks at bottom level</span></span>
<span id="cb58-826"><a href="#cb58-826" aria-hidden="true" tabindex="-1"></a>    block_counts <span class="op">=</span> Counter(blocks[v] <span class="cf">for</span> v <span class="kw">in</span> g.vertices())</span>
<span id="cb58-827"><a href="#cb58-827" aria-hidden="true" tabindex="-1"></a>    n_blocks <span class="op">=</span> <span class="bu">len</span>(block_counts)</span>
<span id="cb58-828"><a href="#cb58-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-829"><a href="#cb58-829" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Bottom-level block sizes:"</span>)</span>
<span id="cb58-830"><a href="#cb58-830" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> block_id, count <span class="kw">in</span> <span class="bu">sorted</span>(block_counts.items(), key<span class="op">=</span><span class="kw">lambda</span> x: <span class="op">-</span>x[<span class="dv">1</span>])[:<span class="dv">10</span>]:</span>
<span id="cb58-831"><a href="#cb58-831" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Block </span><span class="sc">{</span>block_id<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> nodes"</span>)</span>
<span id="cb58-832"><a href="#cb58-832" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_blocks <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb58-833"><a href="#cb58-833" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    ... and </span><span class="sc">{</span>n_blocks <span class="op">-</span> <span class="dv">10</span><span class="sc">}</span><span class="ss"> more blocks"</span>)</span>
<span id="cb58-834"><a href="#cb58-834" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb58-835"><a href="#cb58-835" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Skipping SBM (graph-tool not installed)"</span>)</span>
<span id="cb58-836"><a href="#cb58-836" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-837"><a href="#cb58-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-840"><a href="#cb58-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-841"><a href="#cb58-841" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sbm-analysis</span></span>
<span id="cb58-842"><a href="#cb58-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-843"><a href="#cb58-843" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb58-844"><a href="#cb58-844" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Analyze correspondence between SBM blocks and original communities</span></span>
<span id="cb58-845"><a href="#cb58-845" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">SBM Block Composition (by original community):"</span>)</span>
<span id="cb58-846"><a href="#cb58-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-847"><a href="#cb58-847" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create mapping</span></span>
<span id="cb58-848"><a href="#cb58-848" aria-hidden="true" tabindex="-1"></a>    sbm_assignments <span class="op">=</span> {}</span>
<span id="cb58-849"><a href="#cb58-849" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> g.vertices():</span>
<span id="cb58-850"><a href="#cb58-850" aria-hidden="true" tabindex="-1"></a>        node_id <span class="op">=</span> v_id[v]</span>
<span id="cb58-851"><a href="#cb58-851" aria-hidden="true" tabindex="-1"></a>        block <span class="op">=</span> blocks[v]</span>
<span id="cb58-852"><a href="#cb58-852" aria-hidden="true" tabindex="-1"></a>        orig_comm <span class="op">=</span> v_primary_comm[v]</span>
<span id="cb58-853"><a href="#cb58-853" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> block <span class="kw">not</span> <span class="kw">in</span> sbm_assignments:</span>
<span id="cb58-854"><a href="#cb58-854" aria-hidden="true" tabindex="-1"></a>            sbm_assignments[block] <span class="op">=</span> []</span>
<span id="cb58-855"><a href="#cb58-855" aria-hidden="true" tabindex="-1"></a>        sbm_assignments[block].append(orig_comm)</span>
<span id="cb58-856"><a href="#cb58-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-857"><a href="#cb58-857" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print composition</span></span>
<span id="cb58-858"><a href="#cb58-858" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> block_id <span class="kw">in</span> <span class="bu">sorted</span>(sbm_assignments.keys()):</span>
<span id="cb58-859"><a href="#cb58-859" aria-hidden="true" tabindex="-1"></a>        members <span class="op">=</span> sbm_assignments[block_id]</span>
<span id="cb58-860"><a href="#cb58-860" aria-hidden="true" tabindex="-1"></a>        comm_dist <span class="op">=</span> Counter(members)</span>
<span id="cb58-861"><a href="#cb58-861" aria-hidden="true" tabindex="-1"></a>        dominant <span class="op">=</span> comm_dist.most_common(<span class="dv">1</span>)[<span class="dv">0</span>]</span>
<span id="cb58-862"><a href="#cb58-862" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Block </span><span class="sc">{</span>block_id<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(members)<span class="sc">}</span><span class="ss"> nodes):"</span>)</span>
<span id="cb58-863"><a href="#cb58-863" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Dominant community: </span><span class="sc">{</span>dominant[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>dominant[<span class="dv">1</span>]<span class="op">/</span><span class="bu">len</span>(members)<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb58-864"><a href="#cb58-864" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Distribution: </span><span class="sc">{</span><span class="bu">dict</span>(<span class="bu">sorted</span>(comm_dist.items()))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-865"><a href="#cb58-865" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-866"><a href="#cb58-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-867"><a href="#cb58-867" aria-hidden="true" tabindex="-1"></a><span class="fu">## 11. Visualizing the Hierarchical Block Model</span></span>
<span id="cb58-868"><a href="#cb58-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-869"><a href="#cb58-869" aria-hidden="true" tabindex="-1"></a>The nested SBM produces a rich visualization that combines network topology with hierarchical community structure:</span>
<span id="cb58-870"><a href="#cb58-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-871"><a href="#cb58-871" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reading the Visualization</span></span>
<span id="cb58-872"><a href="#cb58-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-873"><a href="#cb58-873" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Inner ring**: Individual nodes (users) positioned by their block membership</span>
<span id="cb58-874"><a href="#cb58-874" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Outer rings**: Successively coarser block groupings at higher hierarchy levels</span>
<span id="cb58-875"><a href="#cb58-875" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Edge colors**: Mapped to edge weight using a log scale (inferno colormap)—brighter/warmer colors indicate stronger connections</span>
<span id="cb58-876"><a href="#cb58-876" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Edge width**: Also proportional to weight (1–4 pixels on log scale)</span>
<span id="cb58-877"><a href="#cb58-877" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Radial layout**: Nodes in the same block cluster together; the hierarchy shows how fine-grained communities nest within broader groupings</span>
<span id="cb58-878"><a href="#cb58-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-879"><a href="#cb58-879" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting the Block Matrix</span></span>
<span id="cb58-880"><a href="#cb58-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-881"><a href="#cb58-881" aria-hidden="true" tabindex="-1"></a>The block matrix shows edge density between each pair of blocks:</span>
<span id="cb58-882"><a href="#cb58-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-883"><a href="#cb58-883" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Diagonal entries**: Intra-block density (how tightly connected members of the same block are)</span>
<span id="cb58-884"><a href="#cb58-884" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Off-diagonal entries**: Inter-block density (how connected different blocks are to each other)</span>
<span id="cb58-885"><a href="#cb58-885" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Assortative structure**: Strong diagonal with weak off-diagonal indicates communities that primarily connect internally</span>
<span id="cb58-886"><a href="#cb58-886" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Disassortative/core-periphery**: Off-diagonal patterns may reveal hub blocks that bridge communities</span>
<span id="cb58-887"><a href="#cb58-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-890"><a href="#cb58-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-891"><a href="#cb58-891" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sbm-viz-hierarchy</span></span>
<span id="cb58-892"><a href="#cb58-892" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Hierarchical nested block model visualization"</span></span>
<span id="cb58-893"><a href="#cb58-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-894"><a href="#cb58-894" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb58-895"><a href="#cb58-895" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> matplotlib.cm</span>
<span id="cb58-896"><a href="#cb58-896" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Drawing hierarchical block model structure..."</span>)</span>
<span id="cb58-897"><a href="#cb58-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-898"><a href="#cb58-898" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Draw the nested block model hierarchy with edge weights</span></span>
<span id="cb58-899"><a href="#cb58-899" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Edge color and width are mapped to weight using log scale</span></span>
<span id="cb58-900"><a href="#cb58-900" aria-hidden="true" tabindex="-1"></a>    nested_state.draw(</span>
<span id="cb58-901"><a href="#cb58-901" aria-hidden="true" tabindex="-1"></a>        edge_color<span class="op">=</span>gt.prop_to_size(e_weight, power<span class="op">=</span><span class="dv">1</span>, log<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb58-902"><a href="#cb58-902" aria-hidden="true" tabindex="-1"></a>        ecmap<span class="op">=</span>(matplotlib.cm.inferno, <span class="fl">0.6</span>),</span>
<span id="cb58-903"><a href="#cb58-903" aria-hidden="true" tabindex="-1"></a>        eorder<span class="op">=</span>e_weight,</span>
<span id="cb58-904"><a href="#cb58-904" aria-hidden="true" tabindex="-1"></a>        edge_pen_width<span class="op">=</span>gt.prop_to_size(e_weight, <span class="dv">1</span>, <span class="dv">4</span>, power<span class="op">=</span><span class="dv">1</span>, log<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb58-905"><a href="#cb58-905" aria-hidden="true" tabindex="-1"></a>        edge_gradient<span class="op">=</span>[],</span>
<span id="cb58-906"><a href="#cb58-906" aria-hidden="true" tabindex="-1"></a>        vertex_size<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb58-907"><a href="#cb58-907" aria-hidden="true" tabindex="-1"></a>        output_size<span class="op">=</span>(<span class="dv">1200</span>, <span class="dv">1000</span>),</span>
<span id="cb58-908"><a href="#cb58-908" aria-hidden="true" tabindex="-1"></a>        output<span class="op">=</span><span class="st">"../../../data/beerAdvocate/sbm_hierarchy.png"</span></span>
<span id="cb58-909"><a href="#cb58-909" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-910"><a href="#cb58-910" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Saved hierarchical visualization to: sbm_hierarchy.png"</span>)</span>
<span id="cb58-911"><a href="#cb58-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-912"><a href="#cb58-912" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display in notebook</span></span>
<span id="cb58-913"><a href="#cb58-913" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> IPython.display <span class="im">import</span> Image</span>
<span id="cb58-914"><a href="#cb58-914" aria-hidden="true" tabindex="-1"></a>    Image(filename<span class="op">=</span><span class="st">'../../../data/beerAdvocate/sbm_hierarchy.png'</span>)</span>
<span id="cb58-915"><a href="#cb58-915" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb58-916"><a href="#cb58-916" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Skipping SBM visualization (graph-tool not installed)"</span>)</span>
<span id="cb58-917"><a href="#cb58-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-918"><a href="#cb58-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-921"><a href="#cb58-921" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-922"><a href="#cb58-922" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sbm-matrix</span></span>
<span id="cb58-923"><a href="#cb58-923" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Block model edge probability matrix"</span></span>
<span id="cb58-924"><a href="#cb58-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-925"><a href="#cb58-925" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb58-926"><a href="#cb58-926" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize the block model structure at bottom level</span></span>
<span id="cb58-927"><a href="#cb58-927" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb58-928"><a href="#cb58-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-929"><a href="#cb58-929" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get unique block IDs that actually exist</span></span>
<span id="cb58-930"><a href="#cb58-930" aria-hidden="true" tabindex="-1"></a>    unique_blocks <span class="op">=</span> <span class="bu">sorted</span>(block_counts.keys())</span>
<span id="cb58-931"><a href="#cb58-931" aria-hidden="true" tabindex="-1"></a>    block_to_idx <span class="op">=</span> {b: i <span class="cf">for</span> i, b <span class="kw">in</span> <span class="bu">enumerate</span>(unique_blocks)}</span>
<span id="cb58-932"><a href="#cb58-932" aria-hidden="true" tabindex="-1"></a>    n_blocks_viz <span class="op">=</span> <span class="bu">len</span>(unique_blocks)</span>
<span id="cb58-933"><a href="#cb58-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-934"><a href="#cb58-934" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create block matrix (edge counts between blocks)</span></span>
<span id="cb58-935"><a href="#cb58-935" aria-hidden="true" tabindex="-1"></a>    block_matrix <span class="op">=</span> np.zeros((n_blocks_viz, n_blocks_viz))</span>
<span id="cb58-936"><a href="#cb58-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-937"><a href="#cb58-937" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> e <span class="kw">in</span> g.edges():</span>
<span id="cb58-938"><a href="#cb58-938" aria-hidden="true" tabindex="-1"></a>        b1, b2 <span class="op">=</span> blocks[e.source()], blocks[e.target()]</span>
<span id="cb58-939"><a href="#cb58-939" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> b1 <span class="kw">in</span> block_to_idx <span class="kw">and</span> b2 <span class="kw">in</span> block_to_idx:</span>
<span id="cb58-940"><a href="#cb58-940" aria-hidden="true" tabindex="-1"></a>            i1, i2 <span class="op">=</span> block_to_idx[b1], block_to_idx[b2]</span>
<span id="cb58-941"><a href="#cb58-941" aria-hidden="true" tabindex="-1"></a>            block_matrix[i1, i2] <span class="op">+=</span> e_weight[e]</span>
<span id="cb58-942"><a href="#cb58-942" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i1 <span class="op">!=</span> i2:</span>
<span id="cb58-943"><a href="#cb58-943" aria-hidden="true" tabindex="-1"></a>                block_matrix[i2, i1] <span class="op">+=</span> e_weight[e]</span>
<span id="cb58-944"><a href="#cb58-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-945"><a href="#cb58-945" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize by block sizes for probability</span></span>
<span id="cb58-946"><a href="#cb58-946" aria-hidden="true" tabindex="-1"></a>    block_sizes <span class="op">=</span> np.array([block_counts[b] <span class="cf">for</span> b <span class="kw">in</span> unique_blocks])</span>
<span id="cb58-947"><a href="#cb58-947" aria-hidden="true" tabindex="-1"></a>    block_probs <span class="op">=</span> block_matrix <span class="op">/</span> np.outer(block_sizes, block_sizes)</span>
<span id="cb58-948"><a href="#cb58-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-949"><a href="#cb58-949" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot</span></span>
<span id="cb58-950"><a href="#cb58-950" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> ax.imshow(block_probs, cmap<span class="op">=</span><span class="st">'YlOrRd'</span>)</span>
<span id="cb58-951"><a href="#cb58-951" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Block'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb58-952"><a href="#cb58-952" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Block'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb58-953"><a href="#cb58-953" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Hierarchical SBM: Edge Density Between Bottom-Level Blocks'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb58-954"><a href="#cb58-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-955"><a href="#cb58-955" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only show tick labels if not too many blocks</span></span>
<span id="cb58-956"><a href="#cb58-956" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_blocks_viz <span class="op">&lt;=</span> <span class="dv">20</span>:</span>
<span id="cb58-957"><a href="#cb58-957" aria-hidden="true" tabindex="-1"></a>        ax.set_xticks(<span class="bu">range</span>(n_blocks_viz))</span>
<span id="cb58-958"><a href="#cb58-958" aria-hidden="true" tabindex="-1"></a>        ax.set_yticks(<span class="bu">range</span>(n_blocks_viz))</span>
<span id="cb58-959"><a href="#cb58-959" aria-hidden="true" tabindex="-1"></a>        ax.set_xticklabels(unique_blocks)</span>
<span id="cb58-960"><a href="#cb58-960" aria-hidden="true" tabindex="-1"></a>        ax.set_yticklabels(unique_blocks)</span>
<span id="cb58-961"><a href="#cb58-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-962"><a href="#cb58-962" aria-hidden="true" tabindex="-1"></a>    plt.colorbar(im, ax<span class="op">=</span>ax, label<span class="op">=</span><span class="st">'Edge Density'</span>)</span>
<span id="cb58-963"><a href="#cb58-963" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb58-964"><a href="#cb58-964" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">'../../../data/beerAdvocate/block_matrix.png'</span>, dpi<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb58-965"><a href="#cb58-965" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb58-966"><a href="#cb58-966" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Saved: block_matrix.png"</span>)</span>
<span id="cb58-967"><a href="#cb58-967" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb58-968"><a href="#cb58-968" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Skipping block matrix visualization (graph-tool not installed)"</span>)</span>
<span id="cb58-969"><a href="#cb58-969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-970"><a href="#cb58-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-973"><a href="#cb58-973" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb58-974"><a href="#cb58-974" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: final-comparison</span></span>
<span id="cb58-975"><a href="#cb58-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-976"><a href="#cb58-976" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GRAPH_TOOL_AVAILABLE:</span>
<span id="cb58-977"><a href="#cb58-977" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb58-978"><a href="#cb58-978" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"COMMUNITY DETECTION COMPARISON"</span>)</span>
<span id="cb58-979"><a href="#cb58-979" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb58-980"><a href="#cb58-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-981"><a href="#cb58-981" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate SBM modularity for comparison using bottom-level blocks</span></span>
<span id="cb58-982"><a href="#cb58-982" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use actual block IDs from block_counts (they may not be contiguous)</span></span>
<span id="cb58-983"><a href="#cb58-983" aria-hidden="true" tabindex="-1"></a>    sbm_communities <span class="op">=</span> []</span>
<span id="cb58-984"><a href="#cb58-984" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> block_id <span class="kw">in</span> block_counts.keys():</span>
<span id="cb58-985"><a href="#cb58-985" aria-hidden="true" tabindex="-1"></a>        comm <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb58-986"><a href="#cb58-986" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> v <span class="kw">in</span> g.vertices():</span>
<span id="cb58-987"><a href="#cb58-987" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> blocks[v] <span class="op">==</span> block_id:</span>
<span id="cb58-988"><a href="#cb58-988" aria-hidden="true" tabindex="-1"></a>                comm.add(v_id[v])</span>
<span id="cb58-989"><a href="#cb58-989" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> comm:</span>
<span id="cb58-990"><a href="#cb58-990" aria-hidden="true" tabindex="-1"></a>            sbm_communities.append(comm)</span>
<span id="cb58-991"><a href="#cb58-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-992"><a href="#cb58-992" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verify we have a valid partition before calculating modularity</span></span>
<span id="cb58-993"><a href="#cb58-993" aria-hidden="true" tabindex="-1"></a>    all_sbm_nodes <span class="op">=</span> <span class="bu">set</span>().union(<span class="op">*</span>sbm_communities) <span class="cf">if</span> sbm_communities <span class="cf">else</span> <span class="bu">set</span>()</span>
<span id="cb58-994"><a href="#cb58-994" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(all_sbm_nodes) <span class="op">==</span> G_users.number_of_nodes():</span>
<span id="cb58-995"><a href="#cb58-995" aria-hidden="true" tabindex="-1"></a>        sbm_modularity <span class="op">=</span> nx.community.modularity(G_users, sbm_communities)</span>
<span id="cb58-996"><a href="#cb58-996" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb58-997"><a href="#cb58-997" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Warning: SBM partition covers </span><span class="sc">{</span><span class="bu">len</span>(all_sbm_nodes)<span class="sc">}</span><span class="ss"> of </span><span class="sc">{</span>G_users<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss"> nodes"</span>)</span>
<span id="cb58-998"><a href="#cb58-998" aria-hidden="true" tabindex="-1"></a>        sbm_modularity <span class="op">=</span> <span class="bu">float</span>(<span class="st">'nan'</span>)</span>
<span id="cb58-999"><a href="#cb58-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1000"><a href="#cb58-1000" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'Algorithm'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Communities'</span><span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Modularity'</span><span class="sc">:&gt;12}</span><span class="ss">"</span>)</span>
<span id="cb58-1001"><a href="#cb58-1001" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">55</span>)</span>
<span id="cb58-1002"><a href="#cb58-1002" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Louvain'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(louvain_communities)<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>louvain_modularity<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-1003"><a href="#cb58-1003" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Label Propagation'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(label_prop_communities)<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>label_prop_modularity<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-1004"><a href="#cb58-1004" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Greedy Modularity'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">len</span>(greedy_communities)<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>greedy_modularity<span class="sc">:&gt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb58-1005"><a href="#cb58-1005" aria-hidden="true" tabindex="-1"></a>    sbm_mod_str <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>sbm_modularity<span class="sc">:&gt;12.4f}</span><span class="ss">"</span> <span class="cf">if</span> <span class="kw">not</span> np.isnan(sbm_modularity) <span class="cf">else</span> <span class="st">"         N/A"</span></span>
<span id="cb58-1006"><a href="#cb58-1006" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Nested SBM (bottom level)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>n_blocks<span class="sc">:&gt;12}</span><span class="ss"> </span><span class="sc">{</span>sbm_mod_str<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb58-1007"><a href="#cb58-1007" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">55</span>)</span>
<span id="cb58-1008"><a href="#cb58-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1009"><a href="#cb58-1009" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">True communities (from data): 5"</span>)</span>
<span id="cb58-1010"><a href="#cb58-1010" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">The hierarchical nested SBM provides:"</span>)</span>
<span id="cb58-1011"><a href="#cb58-1011" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - </span><span class="sc">{</span><span class="bu">len</span>(levels)<span class="sc">}</span><span class="ss"> levels of hierarchy"</span>)</span>
<span id="cb58-1012"><a href="#cb58-1012" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Bayesian model selection (no need to specify # of communities)"</span>)</span>
<span id="cb58-1013"><a href="#cb58-1013" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Description length: </span><span class="sc">{</span>nested_state<span class="sc">.</span>entropy()<span class="sc">:.2f}</span><span class="ss"> (lower = better fit)"</span>)</span>
<span id="cb58-1014"><a href="#cb58-1014" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Multi-scale community structure discovery"</span>)</span>
<span id="cb58-1015"><a href="#cb58-1015" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb58-1016"><a href="#cb58-1016" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-1017"><a href="#cb58-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1018"><a href="#cb58-1018" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb58-1019"><a href="#cb58-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1020"><a href="#cb58-1020" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary of Methods</span></span>
<span id="cb58-1021"><a href="#cb58-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1022"><a href="#cb58-1022" aria-hidden="true" tabindex="-1"></a>This analysis demonstrates a complete workflow for attention-based market segmentation using network analysis:</span>
<span id="cb58-1023"><a href="#cb58-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1024"><a href="#cb58-1024" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Stage <span class="pp">|</span> Method <span class="pp">|</span> Output <span class="pp">|</span></span>
<span id="cb58-1025"><a href="#cb58-1025" aria-hidden="true" tabindex="-1"></a><span class="pp">|-------|--------|--------|</span></span>
<span id="cb58-1026"><a href="#cb58-1026" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Data representation <span class="pp">|</span> Two-mode network <span class="pp">|</span> Users ↔ Beer styles with weighted edges <span class="pp">|</span></span>
<span id="cb58-1027"><a href="#cb58-1027" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Similarity construction <span class="pp">|</span> Bipartite projection <span class="pp">|</span> One-mode user network (shared interests) <span class="pp">|</span></span>
<span id="cb58-1028"><a href="#cb58-1028" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Structural diagnostics <span class="pp">|</span> Clustering, path length <span class="pp">|</span> Small-world properties confirmed <span class="pp">|</span></span>
<span id="cb58-1029"><a href="#cb58-1029" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Community detection <span class="pp">|</span> Louvain, Label Prop, Greedy <span class="pp">|</span> Modularity-optimized partitions <span class="pp">|</span></span>
<span id="cb58-1030"><a href="#cb58-1030" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Probabilistic inference <span class="pp">|</span> Nested weighted SBM <span class="pp">|</span> Hierarchical block structure with uncertainty quantification <span class="pp">|</span></span>
<span id="cb58-1031"><a href="#cb58-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1032"><a href="#cb58-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Findings</span></span>
<span id="cb58-1033"><a href="#cb58-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1034"><a href="#cb58-1034" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Network structure**: The projected user network exhibits small-world properties—high clustering (users with similar tastes cluster together) combined with short path lengths (any two users are connected through few intermediaries)</span>
<span id="cb58-1035"><a href="#cb58-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1036"><a href="#cb58-1036" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Community recovery**: All algorithms recover communities that align with the underlying beer style families (Traditional British, American Craft, Belgian, Dark/Roasted, Lager), validating that attention patterns reflect meaningful taste segments</span>
<span id="cb58-1037"><a href="#cb58-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1038"><a href="#cb58-1038" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Hierarchical structure**: The nested SBM reveals multi-scale organization—fine-grained sub-communities within broader taste families, potentially identifying micro-segments for targeted marketing</span>
<span id="cb58-1039"><a href="#cb58-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1040"><a href="#cb58-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modularity vs. SBM: When to Use Each</span></span>
<span id="cb58-1041"><a href="#cb58-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1042"><a href="#cb58-1042" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Criterion <span class="pp">|</span> Modularity Methods <span class="pp">|</span> Stochastic Block Models <span class="pp">|</span></span>
<span id="cb58-1043"><a href="#cb58-1043" aria-hidden="true" tabindex="-1"></a><span class="pp">|-----------|-------------------|-------------------------|</span></span>
<span id="cb58-1044"><a href="#cb58-1044" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Speed <span class="pp">|</span> Fast <span class="pp">|</span> Slower (MCMC) <span class="pp">|</span></span>
<span id="cb58-1045"><a href="#cb58-1045" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> # Communities <span class="pp">|</span> Must compare solutions <span class="pp">|</span> Automatically selected <span class="pp">|</span></span>
<span id="cb58-1046"><a href="#cb58-1046" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Edge weights <span class="pp">|</span> Often ignored <span class="pp">|</span> Natively incorporated <span class="pp">|</span></span>
<span id="cb58-1047"><a href="#cb58-1047" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Hierarchy <span class="pp">|</span> Flat or post-hoc <span class="pp">|</span> Built-in nested structure <span class="pp">|</span></span>
<span id="cb58-1048"><a href="#cb58-1048" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Statistical inference <span class="pp">|</span> None <span class="pp">|</span> Full Bayesian framework <span class="pp">|</span></span>
<span id="cb58-1049"><a href="#cb58-1049" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Best for <span class="pp">|</span> Quick exploration <span class="pp">|</span> Rigorous analysis, publication <span class="pp">|</span></span>
<span id="cb58-1050"><a href="#cb58-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1051"><a href="#cb58-1051" aria-hidden="true" tabindex="-1"></a><span class="fu">### Business Implications for Fuller's</span></span>
<span id="cb58-1052"><a href="#cb58-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1053"><a href="#cb58-1053" aria-hidden="true" tabindex="-1"></a>The attention-based segmentation reveals insights that traditional surveys miss:</span>
<span id="cb58-1054"><a href="#cb58-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1055"><a href="#cb58-1055" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Revealed vs. stated preferences**: Network position shows where enthusiasts actually engage, not what they claim to prefer</span>
<span id="cb58-1056"><a href="#cb58-1056" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bridge users**: High-betweenness individuals who span communities may be early adopters or taste-makers worth targeting</span>
<span id="cb58-1057"><a href="#cb58-1057" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Segment stability**: The hierarchical structure suggests which segments are cohesive versus fragmented</span>
<span id="cb58-1058"><a href="#cb58-1058" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Cross-selling opportunities**: Off-diagonal density in the block matrix identifies which segments have natural affinity</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 Simone Santoni</p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://simonesantoni.github.io/net-analysis-smm638">SMM638 - Network Analytics</a></p>
</div>
    <div class="nav-footer-right">
<p>Made with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>