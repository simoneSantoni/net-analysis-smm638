---
title: "SoundCloud Network Data - Exploratory Data Analysis"
subtitle: "Week 5 - Network Analytics"
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: false
    code-tools: true
execute:
  freeze: auto
---

## Overview

This exploratory data analysis examines the SoundCloud dataset, which contains information about users, tracks, social connections, and engagement patterns from 2019-2020, with a focus on hip-hop music. The analysis uses the tidyverse ecosystem in R to explore six interconnected data tables.

## Setup and Data Loading

```{r setup, message=FALSE, warning=FALSE}
# Load required libraries
library(tidyverse)
library(gridExtra)
library(knitr)

# Set theme for plots
theme_set(theme_minimal())

# Configure output options
opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 10,
  fig.height = 6
)

# Disable httpgd
options(vsc.use_httpgd = FALSE)
```

```{r load-data}
# Set data path
data_path <- "../../../data/soundcloud/output/"

# Load all CSV files
users <- read_csv(paste0(data_path, "users.csv"), show_col_types = FALSE)
tracks <- read_csv(paste0(data_path, "tracks.csv"), show_col_types = FALSE)
follows <- read_csv(paste0(data_path, "follows.csv"), show_col_types = FALSE)
engagements <- read_csv(paste0(data_path, "engagements.csv"), show_col_types = FALSE)
streaming_events <- read_csv(paste0(data_path, "streaming_events.csv"), show_col_types = FALSE)
playlists <- read_csv(paste0(data_path, "playlists.csv"), show_col_types = FALSE)

cat("All datasets loaded successfully!\n")
```

## Users Data Analysis

### Basic Information

```{r users-info}
cat("Dataset dimensions:", nrow(users), "rows,", ncol(users), "columns\n")
cat("Columns:", paste(names(users), collapse = ", "), "\n\n")

# Summary statistics
summary(users[, c("follower_count", "following_count", "track_count", "total_plays")])
```

### Missing Values Check

```{r users-missing}
# Check for missing values
missing_check <- colSums(is.na(users))
if (any(missing_check > 0)) {
  data.frame(
    column = names(missing_check)[missing_check > 0],
    missing_count = missing_check[missing_check > 0]
  ) %>%
    kable(caption = "Columns with missing values")
} else {
  cat("No missing values found in the users dataset.\n")
}
```

### User Statistics

```{r users-stats}
users %>% 
  summarise(
    `Total Users` = n(),
    `Avg Followers` = round(mean(follower_count), 2),
    `Median Followers` = median(follower_count),
    `Avg Following` = round(mean(following_count), 2),
    `Median Following` = median(following_count),
    `Avg Tracks` = round(mean(track_count), 2),
    `Median Tracks` = median(track_count)
  ) %>% 
  kable(caption = "User Statistics Summary")
```

### User Type Distribution

```{r users-types}
users %>% 
  count(user_type, sort = TRUE) %>% 
  mutate(percentage = round(n / sum(n) * 100, 1)) %>%
  kable(caption = "User Type Distribution", col.names = c("User Type", "Count", "Percentage"))
```

### Follower Distribution Visualization

```{r users-follower-viz, fig.cap="Distribution of follower counts (log scale, excluding top 1%)"}
users %>% 
  filter(follower_count < quantile(follower_count, 0.99)) %>% 
  ggplot(aes(x = follower_count + 1)) +
  geom_histogram(fill = "steelblue", bins = 50, alpha = 0.8) +
  scale_x_log10() +
  labs(
    title = "Distribution of Follower Counts",
    x = "Follower Count + 1 (log10 scale)",
    y = "Number of Users"
  )
```

## Tracks Data Analysis

### Track Overview

```{r tracks-info}
cat("Dataset dimensions:", nrow(tracks), "rows,", ncol(tracks), "columns\n\n")

tracks %>% 
  summarise(
    `Total Tracks` = n(),
    `Avg Duration (sec)` = round(mean(duration_sec), 1),
    `Avg Play Count` = round(mean(play_count), 1),
    `Avg Like Count` = round(mean(like_count), 1),
    `Avg Repost Count` = round(mean(repost_count), 1),
    `Avg Comment Count` = round(mean(comment_count), 1)
  ) %>% 
  kable(caption = "Track Statistics Summary")
```

### Top Genres

```{r tracks-genres}
tracks %>% 
  count(genre_primary, sort = TRUE) %>% 
  head(10) %>% 
  mutate(percentage = round(n / nrow(tracks) * 100, 1)) %>%
  kable(caption = "Top 10 Primary Genres", col.names = c("Genre", "Count", "Percentage"))
```

### Play Count Distribution

```{r tracks-play-viz, fig.cap="Distribution of track play counts (log scale)"}
tracks %>% 
  filter(play_count > 0) %>% 
  ggplot(aes(x = play_count)) +
  geom_histogram(fill = "coral", bins = 50, alpha = 0.8) +
  scale_x_log10() +
  labs(
    title = "Distribution of Track Play Counts",
    x = "Play Count (log10 scale)",
    y = "Number of Tracks"
  )
```

### Genre Distribution Visualization

```{r genre-viz, fig.height=8, fig.cap="Top 20 music genres by track count"}
tracks %>% 
  count(genre_primary, sort = TRUE) %>% 
  head(20) %>% 
  ggplot(aes(x = reorder(genre_primary, n), y = n)) +
  geom_col(fill = "orange", alpha = 0.8) +
  coord_flip() +
  labs(
    title = "Top 20 Music Genres",
    x = "Genre",
    y = "Number of Tracks"
  )
```

## Social Network Analysis

### Follow Network Statistics

```{r follows-stats}
follows %>% 
  summarise(
    `Total Connections` = n(),
    `Unique Followers` = n_distinct(follower_id),
    `Unique Followed` = n_distinct(followee_id),
    `Avg Connections per User` = round(n() / n_distinct(follower_id), 2)
  ) %>% 
  kable(caption = "Follow Network Overview")
```

### Most Followed Users

```{r follows-top}
follows %>% 
  count(followee_id, sort = TRUE) %>% 
  head(10) %>% 
  left_join(users, by = c("followee_id" = "user_id")) %>% 
  select(followee_id, username, n) %>% 
  kable(caption = "Top 10 Most Followed Users", 
        col.names = c("User ID", "Username", "Follower Count"))
```

### Network Degree Analysis

```{r network-degrees}
# Calculate in-degree and out-degree
out_degree <- follows %>% count(follower_id, name = "out_degree")
in_degree <- follows %>% count(followee_id, name = "in_degree")

# Combine and summarize
degree_stats <- full_join(
  out_degree %>% rename(user_id = follower_id),
  in_degree %>% rename(user_id = followee_id),
  by = "user_id"
) %>%
  replace_na(list(out_degree = 0, in_degree = 0))

degree_stats %>%
  summarise(
    `Avg Out-degree` = round(mean(out_degree), 2),
    `Max Out-degree` = max(out_degree),
    `Avg In-degree` = round(mean(in_degree), 2),
    `Max In-degree` = max(in_degree)
  ) %>%
  kable(caption = "Network Degree Statistics")
```

## User Engagement Analysis

### Engagement Types

```{r engagement-types}
engagements %>% 
  count(engagement_type, sort = TRUE) %>% 
  mutate(percentage = round(n / sum(n) * 100, 1)) %>%
  kable(caption = "Distribution of Engagement Types", 
        col.names = c("Engagement Type", "Count", "Percentage"))
```

### Engagement Overview

```{r engagement-stats}
engagements %>% 
  summarise(
    `Total Engagements` = n(),
    `Unique Users` = n_distinct(user_id),
    `Unique Tracks` = n_distinct(track_id),
    `Avg Engagements per User` = round(n() / n_distinct(user_id), 1),
    `Avg Engagements per Track` = round(n() / n_distinct(track_id), 1)
  ) %>% 
  kable(caption = "Engagement Statistics")
```

### Engagement Visualization

```{r engagement-viz, fig.cap="Distribution of engagement types"}
engagements %>% 
  count(engagement_type) %>% 
  ggplot(aes(x = reorder(engagement_type, n), y = n)) +
  geom_col(fill = "darkgreen", alpha = 0.8) +
  coord_flip() +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Engagement Type Distribution",
    x = "Engagement Type",
    y = "Count"
  )
```

## Streaming Behavior Analysis

### Streaming Statistics

```{r streaming-stats}
streaming_events %>% 
  summarise(
    `Total Streams` = n(),
    `Unique Users` = n_distinct(user_id),
    `Unique Tracks` = n_distinct(track_id),
    `Avg Duration (sec)` = round(mean(duration_played_sec), 1),
    `Avg Completion Rate` = round(mean(completion_rate), 3)
  ) %>% 
  kable(caption = "Streaming Event Statistics")
```

### Streaming Sources

```{r streaming-sources}
streaming_events %>% 
  count(source, sort = TRUE) %>% 
  mutate(percentage = round(n / sum(n) * 100, 1)) %>%
  kable(caption = "Distribution of Streaming Sources", 
        col.names = c("Source", "Count", "Percentage"))
```

### Source Visualization

```{r streaming-viz, fig.cap="Distribution of streaming sources"}
streaming_events %>% 
  count(source) %>% 
  ggplot(aes(x = reorder(source, n), y = n)) +
  geom_col(fill = "navy", alpha = 0.8) +
  coord_flip() +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Streaming Source Distribution",
    x = "Source Type",
    y = "Number of Streams"
  )
```

## Playlist Analysis

```{r playlist-stats}
playlists %>% 
  mutate(track_count = str_count(track_ids, ",") + 1) %>%
  summarise(
    `Total Playlists` = n(),
    `Unique Creators` = n_distinct(creator_id),
    `Avg Tracks per Playlist` = round(mean(track_count), 1),
    `Median Tracks per Playlist` = median(track_count),
    `Avg Followers` = round(mean(follower_count), 1),
    `Median Followers` = median(follower_count)
  ) %>% 
  kable(caption = "Playlist Statistics")
```

## Combined Visualizations

```{r combined-viz, fig.width=12, fig.height=10, fig.cap="Overview of key distributions"}
# Create four key plots
p1 <- users %>% 
  filter(follower_count < quantile(follower_count, 0.99)) %>% 
  ggplot(aes(x = follower_count + 1)) +
  geom_histogram(fill = "steelblue", bins = 30, alpha = 0.8) +
  scale_x_log10() +
  labs(title = "Follower Distribution", x = "Followers (log)", y = "Count") +
  theme_minimal()

p2 <- tracks %>% 
  filter(play_count > 0) %>% 
  ggplot(aes(x = play_count)) +
  geom_histogram(fill = "coral", bins = 30, alpha = 0.8) +
  scale_x_log10() +
  labs(title = "Play Count Distribution", x = "Plays (log)", y = "Count") +
  theme_minimal()

p3 <- engagements %>% 
  count(engagement_type) %>% 
  ggplot(aes(x = engagement_type, y = n)) +
  geom_col(fill = "darkgreen", alpha = 0.8) +
  labs(title = "Engagement Types", x = "", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

p4 <- users %>% 
  count(user_type) %>% 
  ggplot(aes(x = user_type, y = n)) +
  geom_col(fill = "purple", alpha = 0.8) +
  labs(title = "User Types", x = "", y = "Count") +
  theme_minimal()

# Combine plots
grid.arrange(p1, p2, p3, p4, nrow = 2, ncol = 2)
```

## Key Insights

This exploratory data analysis reveals several important patterns in the SoundCloud dataset:

1. **User Ecosystem**: The platform has a healthy distribution with 75% listeners, 20% creators, and 5% curators, indicating an active content creation and curation community.

2. **Content Characteristics**: The dataset is heavily focused on hip-hop music, with the top 5 subgenres (Trap, Alternative Hip-Hop, Boom Bap, Lo-Fi, and SoundCloud Rap) representing over 80% of all tracks.

3. **Engagement Patterns**: User engagement is highly active with likes comprising 60% of all engagements, followed by reposts (30%) and comments (10%). The high engagement-to-play ratio suggests an invested community.

4. **Network Structure**: The follow network shows a relatively balanced distribution with no extreme influencers in this sample (maximum 20 followers), suggesting either a niche community or a sample of regular users.

5. **Discovery Patterns**: Users discover content through multiple channels - 44% direct access, 36% through playlists, and 20% via reposts, indicating diverse discovery mechanisms.

6. **Listening Behavior**: The average completion rate of 48% suggests users actively browse and sample tracks rather than listening to complete songs, which is typical for music discovery platforms.

This dataset provides excellent opportunities for various network analyses including social network analysis, bipartite network modeling, community detection, and recommendation system development.